require.config({baseUrl:"/plugin/pagebuilder/libs/",paths:{domReady:"domReady",fancybox:"../../../fancybox/jquery.fancybox.pack",toolbar:"buttons",jquery:"jquery-1.9.1.min",multiselect:"../../../jqGrid/plugins/ui.multiselect",json2:"json2",pnotify:"jquery.pnotify.min",require:"require.min",select2:"select2.min",tagsinput:"jquery.tagsinput.min","page-templates":"../templates",text:"text",underscore:"lodash"},shim:{pnotify:"pnotify",fancybox:"fancybox",multiselect:"multiselect"}}),define("domReady",[],function(){function e(e){var t;for(t=0;e.length>t;t+=1)e[t](c)}function t(){var t=u;l&&t.length&&(u=[],e(t))}function n(){l||(l=!0,s&&clearInterval(s),t())}function i(e){return l?e(c):u.push(e),i}var a,o,s,r="undefined"!=typeof window&&window.document,l=!r,c=r?document:null,u=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),o=document.createElement("div");try{a=null===window.frameElement}catch(d){}o.doScroll&&a&&window.external&&(s=setInterval(function(){try{o.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(e,t,n,a){a.isBuild?n(null):i(n)},i}),function(e){function t(i){function o(e){return e&&"object"==typeof e&&!bi(e)&&Jn.call(e,"__wrapped__")?e:new M(e)}function S(e,t,n){var i=e.length,a=i-t>=n;if(a)for(var o={},s=t-1;i>++s;){var r=Hn(e[s]);(Jn.call(o,r)?o[r]:o[r]=[]).push(e[s])}return function(n){if(a){var i=Hn(n);return Jn.call(o,i)&&zt(o[i],n)>-1}return zt(e,n,t)>-1}}function B(e){return e.charCodeAt(0)}function I(e,t){var i=e.index,a=t.index;if(e=e.criteria,t=t.criteria,e!==t){if(e>t||e===n)return 1;if(t>e||t===n)return-1}return a>i?-1:1}function R(e,t,n,i){function a(){var i=arguments,c=s?this:t;if(o||(e=t[r]),n.length&&(i=i.length?(i=z(i),l?i.concat(n):n.concat(i)):n),this instanceof a){W.prototype=e.prototype,c=new W,W.prototype=null;var u=e.apply(c,i);return ot(u)?u:c}return e.apply(c,i)}var o=at(e),s=!n,r=t;if(s){var l=i;n=t}else if(!o){if(!i)throw new Mn;t=e}return a}function D(){for(var e,t={arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!wi},n=0;e=arguments[n];n++)for(var i in e)t[i]=e[i];var a=t.args;t.firstArg=/^[^,]+/.exec(a)[0];var s=Bn("hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectTypes","return function("+a+") {\n"+fi(t)+"\n}");return s(Jn,U,bi,ut,wi,o,P)}function N(e){return"\\"+O[e]}function H(e){return xi[e]}function M(e){this.__wrapped__=e}function W(){}function q(e){var t=!1;if(!e||ei.call(e)!=j)return t;var n=e.constructor;return(at(n)?n instanceof n:hi.nodeClass||!isNode(e))?(Si(e,function(e,n){t=n}),t===!1||Jn.call(e,t)):t}function z(e,t,i){t||(t=0),i===n&&(i=e?e.length:0);for(var a=-1,o=i-t||0,s=Pn(0>o?0:o);o>++a;)s[a]=e[t+a];return s}function F(e){return _i[e]}function U(e){return ei.call(e)==x}function K(e,t,i,a,s,r){var l=e;if("function"==typeof t&&(a=i,i=t,t=!1),"function"==typeof i){if(i=a===n?i:o.createCallback(i,a,1),l=i(l),l!==n)return l;l=e}var c=ot(l);if(c){var u=ei.call(l);if(!L[u])return l;var d=bi(l)}if(!c||!t)return c?d?z(l):Ci({},l):l;var p=pi[u];switch(u){case C:case k:return new p(+l);case T:case $:return new p(l);case E:return p(l.source,h.exec(l))}s||(s=[]),r||(r=[]);for(var f=s.length;f--;)if(s[f]==e)return r[f];return l=d?p(l.length):{},d&&(Jn.call(e,"index")&&(l.index=e.index),Jn.call(e,"input")&&(l.input=e.input)),s.push(e),r.push(l),(d?Ct:Ti)(e,function(e,a){l[a]=K(e,t,i,n,s,r)}),l}function V(e,t,n){return K(e,!0,t,n)}function X(e,t,i){var a;return t=o.createCallback(t,i),Ti(e,function(e,i,o){return t(e,i,o)?(a=i,!1):n}),a}function G(e){var t=[];return Si(e,function(e,n){at(e)&&t.push(n)}),t.sort()}function J(e,t){return e?Jn.call(e,t):!1}function Q(e){for(var t=-1,n=wi(e),i=n.length,a={};i>++t;){var o=n[t];a[e[o]]=o}return a}function Z(e){return e===!0||e===!1||ei.call(e)==C}function Y(e){return e instanceof An||ei.call(e)==k}function et(e){return e?1===e.nodeType:!1}function tt(e){var t=!0;if(!e)return t;var n=ei.call(e),i=e.length;return n==_||n==$||n==x||n==j&&"number"==typeof i&&at(e.splice)?!i:(Ti(e,function(){return t=!1}),t)}function nt(e,t,i,a,s,l){var c=i===r;if(i&&!c){i=a===n?i:o.createCallback(i,a,2);var u=i(e,t);if(u!==n)return!!u}if(e===t)return 0!==e||1/e==1/t;var d=typeof e,p=typeof t;if(e===e&&(!e||"function"!=d&&"object"!=d)&&(!t||"function"!=p&&"object"!=p))return!1;if(null==e||null==t)return e===t;var h=ei.call(e),f=ei.call(t);if(h==x&&(h=j),f==x&&(f=j),h!=f)return!1;switch(h){case C:case k:return+e==+t;case T:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case E:case $:return e==Hn(t)}var g=h==_;if(!g){if(Jn.call(e,"__wrapped__ ")||Jn.call(t,"__wrapped__"))return nt(e.__wrapped__||e,t.__wrapped__||t,i,a,s,l);if(h!=j)return!1;var v=e.constructor,m=t.constructor;if(v!=m&&!(at(v)&&v instanceof v&&at(m)&&m instanceof m))return!1}s||(s=[]),l||(l=[]);for(var b=s.length;b--;)if(s[b]==e)return l[b]==t;var y=0;if(u=!0,s.push(e),l.push(t),g){if(b=e.length,y=t.length,u=y==e.length,!u&&!c)return u;for(;y--;){var w=b,S=t[y];if(c)for(;w--&&!(u=nt(e[w],S,i,a,s,l)););else if(!(u=nt(e[y],S,i,a,s,l)))break}return u}return Si(t,function(t,o,r){return Jn.call(r,o)?(y++,u=Jn.call(e,o)&&nt(e[o],t,i,a,s,l)):n}),u&&!c&&Si(e,function(e,t,i){return Jn.call(i,t)?u=--y>-1:n}),u}function it(e){return ii(e)&&!ai(parseFloat(e))}function at(e){return"function"==typeof e}function ot(e){return e?P[typeof e]:!1}function st(e){return lt(e)&&e!=+e}function rt(e){return null===e}function lt(e){return"number"==typeof e||ei.call(e)==T}function ct(e){return e instanceof Nn||ei.call(e)==E}function ut(e){return"string"==typeof e||ei.call(e)==$}function dt(e){return e===n}function pt(e,t,i){var a=arguments,s=0,l=2;if(!ot(e))return e;if(i===r)var c=a[3],u=a[4],d=a[5];else u=[],d=[],"number"!=typeof i&&(l=a.length),l>3&&"function"==typeof a[l-2]?c=o.createCallback(a[--l-1],a[l--],2):l>2&&"function"==typeof a[l-1]&&(c=a[--l]);for(;l>++s;)(bi(a[s])?Ct:Ti)(a[s],function(t,i){var a,o,s=t,l=e[i];if(t&&((o=bi(t))||ji(t))){for(var p=u.length;p--;)if(a=u[p]==t){l=d[p];break}a||(l=o?bi(l)?l:[]:ji(l)?l:{},c&&(s=c(l,t),s!==n&&(l=s)),u.push(t),d.push(l),c||(l=pt(l,t,r,c,u,d)))}else c&&(s=c(l,t),s===n&&(s=t)),s!==n&&(l=s);e[i]=l});return e}function ht(e,t,n){var i="function"==typeof t,a={};if(i)t=o.createCallback(t,n);else var s=Vn.apply(Wn,arguments);return Si(e,function(e,n,o){(i?!t(e,n,o):0>zt(s,n,1))&&(a[n]=e)}),a}function ft(e){for(var t=-1,n=wi(e),i=n.length,a=Pn(i);i>++t;){var o=n[t];a[t]=[o,e[o]]}return a}function gt(e,t,n){var i={};if("function"!=typeof t)for(var a=0,s=Vn.apply(Wn,arguments),r=ot(e)?s.length:0;r>++a;){var l=s[a];l in e&&(i[l]=e[l])}else t=o.createCallback(t,n),Si(e,function(e,n,a){t(e,n,a)&&(i[n]=e)});return i}function vt(e){for(var t=-1,n=wi(e),i=n.length,a=Pn(i);i>++t;)a[t]=e[n[t]];return a}function mt(e){for(var t=-1,n=Vn.apply(Wn,z(arguments,1)),i=n.length,a=Pn(i);i>++t;)a[t]=e[n[t]];return a}function bt(e,t,i){var a=-1,o=e?e.length:0,s=!1;return i=(0>i?si(0,o+i):i)||0,"number"==typeof o?s=(ut(e)?e.indexOf(t,i):zt(e,t,i))>-1:Ti(e,function(e){return++a>=i?!(s=e===t):n}),s}function yt(e,t,n){var i={};return t=o.createCallback(t,n),Ct(e,function(e,n,a){n=Hn(t(e,n,a)),Jn.call(i,n)?i[n]++:i[n]=1}),i}function wt(e,t,n){var i=!0;t=o.createCallback(t,n);var a=-1,s=e?e.length:0;if("number"==typeof s)for(;s>++a&&(i=!!t(e[a],a,e)););else Ti(e,function(e,n,a){return i=!!t(e,n,a)});return i}function xt(e,t,n){var i=[];t=o.createCallback(t,n);var a=-1,s=e?e.length:0;if("number"==typeof s)for(;s>++a;){var r=e[a];t(r,a,e)&&i.push(r)}else Ti(e,function(e,n,a){t(e,n,a)&&i.push(e)});return i}function _t(e,t,i){t=o.createCallback(t,i);var a=-1,s=e?e.length:0;if("number"!=typeof s){var r;return Ti(e,function(e,i,a){return t(e,i,a)?(r=e,!1):n}),r}for(;s>++a;){var l=e[a];if(t(l,a,e))return l}}function Ct(e,t,i){var a=-1,s=e?e.length:0;if(t=t&&i===n?t:o.createCallback(t,i),"number"==typeof s)for(;s>++a&&t(e[a],a,e)!==!1;);else Ti(e,t);return e}function kt(e,t,n){var i={};return t=o.createCallback(t,n),Ct(e,function(e,n,a){n=Hn(t(e,n,a)),(Jn.call(i,n)?i[n]:i[n]=[]).push(e)}),i}function St(e,t){var n=z(arguments,2),i=-1,a="function"==typeof t,o=e?e.length:0,s=Pn("number"==typeof o?o:0);return Ct(e,function(e){s[++i]=(a?t:e[t]).apply(e,n)}),s}function Tt(e,t,n){var i=-1,a=e?e.length:0;if(t=o.createCallback(t,n),"number"==typeof a)for(var s=Pn(a);a>++i;)s[i]=t(e[i],i,e);else s=[],Ti(e,function(e,n,a){s[++i]=t(e,n,a)});return s}function jt(e,t,n){var i=-1/0,a=i;if(!t&&bi(e))for(var s=-1,r=e.length;r>++s;){var l=e[s];l>a&&(a=l)}else t=!t&&ut(e)?B:o.createCallback(t,n),Ct(e,function(e,n,o){var s=t(e,n,o);s>i&&(i=s,a=e)});return a}function Et(e,t,n){var i=1/0,a=i;if(!t&&bi(e))for(var s=-1,r=e.length;r>++s;){var l=e[s];a>l&&(a=l)}else t=!t&&ut(e)?B:o.createCallback(t,n),Ct(e,function(e,n,o){var s=t(e,n,o);i>s&&(i=s,a=e)});return a}function $t(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i)for(var a=Pn(i);i>++n;)a[n]=e[n][t];return a||Tt(e,t)}function Lt(e,t,n,i){if(!e)return n;var a=3>arguments.length;t=o.createCallback(t,i,4);var s=-1,r=e.length;if("number"==typeof r)for(a&&(n=e[++s]);r>++s;)n=t(n,e[s],s,e);else Ti(e,function(e,i,o){n=a?(a=!1,e):t(n,e,i,o)});return n}function Pt(e,t,n,i){var a=e,s=e?e.length:0,r=3>arguments.length;if("number"!=typeof s){var l=wi(e);s=l.length}return t=o.createCallback(t,i,4),Ct(e,function(e,i,o){i=l?l[--s]:--s,n=r?(r=!1,a[i]):t(n,a[i],i,o)}),n}function Ot(e,t,n){return t=o.createCallback(t,n),xt(e,function(e,n,i){return!t(e,n,i)})}function At(e){var t=-1,n=e?e.length:0,i=Pn("number"==typeof n?n:0);return Ct(e,function(e){var n=Xn(ci()*(++t+1));i[t]=i[n],i[n]=e}),i}function Bt(e){var t=e?e.length:0;return"number"==typeof t?t:wi(e).length}function It(e,t,n){var i;t=o.createCallback(t,n);var a=-1,s=e?e.length:0;if("number"==typeof s)for(;s>++a&&!(i=t(e[a],a,e)););else Ti(e,function(e,n,a){return!(i=t(e,n,a))});return!!i}function Rt(e,t,n){var i=-1,a=e?e.length:0,s=Pn("number"==typeof a?a:0);for(t=o.createCallback(t,n),Ct(e,function(e,n,a){s[++i]={criteria:t(e,n,a),index:i,value:e}}),a=s.length,s.sort(I);a--;)s[a]=s[a].value;return s}function Dt(e){return e&&"number"==typeof e.length?z(e):vt(e)}function Nt(e){for(var t=-1,n=e?e.length:0,i=[];n>++t;){var a=e[t];a&&i.push(a)}return i}function Ht(e){for(var t=-1,n=e?e.length:0,i=Vn.apply(Wn,arguments),a=S(i,n,100),o=[];n>++t;){var s=e[t];a(s)||o.push(s)}return o}function Mt(e,t,n){var i=-1,a=e?e.length:0;for(t=o.createCallback(t,n);a>++i;)if(t(e[i],i,e))return i;return-1}function Wt(e,t,n){if(e){var i=0,a=e.length;if("number"!=typeof t&&null!=t){var s=-1;for(t=o.createCallback(t,n);a>++s&&t(e[s],s,e);)i++}else if(i=t,null==i||n)return e[0];return z(e,0,ri(si(0,i),a))}}function qt(e,t,n,i){var a=-1,s=e?e.length:0,r=[];for("boolean"!=typeof t&&null!=t&&(i=n,n=t,t=!1),null!=n&&(n=o.createCallback(n,i));s>++a;){var l=e[a];n&&(l=n(l,a,e)),bi(l)?Qn.apply(r,t?l:qt(l)):r.push(l)}return r}function zt(e,t,n){var i=-1,a=e?e.length:0;if("number"==typeof n)i=(0>n?si(0,a+n):n||0)-1;else if(n)return i=Jt(e,t),e[i]===t?i:-1;for(;a>++i;)if(e[i]===t)return i;return-1}function Ft(e,t,n){if(!e)return[];var i=0,a=e.length;if("number"!=typeof t&&null!=t){var s=a;for(t=o.createCallback(t,n);s--&&t(e[s],s,e);)i++}else i=null==t||n?1:t||i;return z(e,0,ri(si(0,a-i),a))}function Ut(e){var t=arguments,n=t.length,i={0:{}},a=-1,o=e?e.length:0,s=o>=100,r=[],l=r;e:for(;o>++a;){var c=e[a];if(s)var u=Hn(c),d=Jn.call(i[0],u)?!(l=i[0][u]):l=i[0][u]=[];if(d||0>zt(l,c)){s&&l.push(c);for(var p=n;--p;)if(!(i[p]||(i[p]=S(t[p],0,100)))(c))continue e;r.push(c)}}return r}function Kt(e,t,n){if(e){var i=0,a=e.length;if("number"!=typeof t&&null!=t){var s=a;for(t=o.createCallback(t,n);s--&&t(e[s],s,e);)i++}else if(i=t,null==i||n)return e[a-1];return z(e,si(0,a-i))}}function Vt(e,t,n){var i=e?e.length:0;for("number"==typeof n&&(i=(0>n?si(0,i+n):ri(n,i-1))+1);i--;)if(e[i]===t)return i;return-1}function Xt(e,t,n){e=+e||0,n=+n||1,null==t&&(t=e,e=0);for(var i=-1,a=si(0,Un((t-e)/n)),o=Pn(a);a>++i;)o[i]=e,e+=n;return o}function Gt(e,t,n){if("number"!=typeof t&&null!=t){var i=0,a=-1,s=e?e.length:0;for(t=o.createCallback(t,n);s>++a&&t(e[a],a,e);)i++}else i=null==t||n?1:si(0,t);return z(e,i)}function Jt(e,t,n,i){var a=0,s=e?e.length:a;for(n=n?o.createCallback(n,i,1):yn,t=n(t);s>a;){var r=a+s>>>1;t>n(e[r])?a=r+1:s=r}return a}function Qt(){return Zt(Vn.apply(Wn,arguments))}function Zt(e,t,n,i){var a=-1,s=e?e.length:0,r=[],l=r;"boolean"!=typeof t&&null!=t&&(i=n,n=t,t=!1);var c=!t&&s>=75;if(c)var u={};for(null!=n&&(l=[],n=o.createCallback(n,i));s>++a;){var d=e[a],p=n?n(d,a,e):d;if(c)var h=Hn(p),f=Jn.call(u,h)?!(l=u[h]):l=u[h]=[];(t?!a||l[l.length-1]!==p:f||0>zt(l,p))&&((n||c)&&l.push(p),r.push(d))}return r}function Yt(e){for(var t=-1,n=e?e.length:0,i=S(arguments,1,30),a=[];n>++t;){var o=e[t];i(o)||a.push(o)}return a}function en(e){for(var t=-1,n=e?jt($t(arguments,"length")):0,i=Pn(n);n>++t;)i[t]=$t(arguments,t);return i}function tn(e,t){for(var n=-1,i=e?e.length:0,a={};i>++n;){var o=e[n];t?a[o]=t[n]:a[o[0]]=o[1]}return a}function nn(e,t){return 1>e?t():function(){return 1>--e?t.apply(this,arguments):n}}function an(e,t){return hi.fastBind||ti&&arguments.length>2?ti.call.apply(ti,arguments):R(e,t,z(arguments,2))}function on(e){for(var t=Vn.apply(Wn,arguments),n=t.length>1?0:(t=G(e),-1),i=t.length;i>++n;){var a=t[n];e[a]=an(e[a],e)}return e}function sn(e,t){return R(e,t,z(arguments,2),r)}function rn(){var e=arguments;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}}function ln(e,t,i){if(null==e)return yn;var a=typeof e;if("function"!=a){if("object"!=a)return function(t){return t[e]};var o=wi(e);return function(t){for(var n=o.length,i=!1;n--&&(i=nt(t[o[n]],e[o[n]],r)););return i}}return t!==n?1===i?function(n){return e.call(t,n)}:2===i?function(n,i){return e.call(t,n,i)}:4===i?function(n,i,a,o){return e.call(t,n,i,a,o)}:function(n,i,a){return e.call(t,n,i,a)}:e}function cn(e,t,n){function i(){r=null,n||(o=e.apply(s,a))}var a,o,s,r;return function(){var l=n&&!r;return a=arguments,s=this,Kn(r),r=Yn(i,t),l&&(o=e.apply(s,a)),o}}function un(e){var t=z(arguments,1);return Yn(function(){e.apply(n,t)},1)}function dn(e,t){var i=z(arguments,2);return Yn(function(){e.apply(n,i)},t)}function pn(e,t){var n={};return function(){var i=Hn(t?t.apply(this,arguments):arguments[0]);return Jn.call(n,i)?n[i]:n[i]=e.apply(this,arguments)}}function hn(e){var t,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function fn(e){return R(e,z(arguments,1))}function gn(e){return R(e,z(arguments,1),null,r)}function vn(e,t){function n(){r=new An,s=null,a=e.apply(o,i)}var i,a,o,s,r=0;return function(){var l=new An,c=t-(l-r);return i=arguments,o=this,0>=c?(Kn(s),s=null,r=l,a=e.apply(o,i)):s||(s=Yn(n,c)),a}}function mn(e,t){return function(){var n=[e];return Qn.apply(n,arguments),t.apply(this,n)}}function bn(e){return null==e?"":Hn(e).replace(m,H)}function yn(e){return e}function wn(e){Ct(G(e),function(t){var n=o[t]=e[t];o.prototype[t]=function(){var e=this.__wrapped__,t=[e];Qn.apply(t,arguments);var i=n.apply(o,t);return e&&"object"==typeof e&&e==i?this:new M(i)}})}function xn(){return i._=zn,this}function _n(e,t){return null==e&&null==t&&(t=1),e=+e||0,null==t&&(t=e,e=0),e+Xn(ci()*((+t||0)-e+1))}function Cn(e,t){var i=e?e[t]:n;return at(i)?e[t]():i}function kn(e,t,i){var a=o.templateSettings;e||(e=""),i=ki({},i,a);var s,r=ki({},i.imports,a.imports),d=wi(r),h=vt(r),g=0,m=i.interpolate||v,y="__p += '",x=Nn((i.escape||v).source+"|"+m.source+"|"+(m===f?p:v).source+"|"+(i.evaluate||v).source+"|$","g");e.replace(x,function(t,n,i,a,o,r){return i||(i=a),y+=e.slice(g,r).replace(b,N),n&&(y+="' +\n__e("+n+") +\n'"),o&&(s=!0,y+="';\n"+o+";\n__p += '"),i&&(y+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),g=r+t.length,t}),y+="';\n";var _=i.variable,C=_;C||(_="obj",y="with ("+_+") {\n"+y+"\n}\n"),y=(s?y.replace(l,""):y).replace(c,"$1").replace(u,"$1;"),y="function("+_+") {\n"+(C?"":_+" || ("+_+" = {});\n")+"var __t, __p = '', __e = _.escape"+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+y+"return __p\n}";var k="\n/*\n//@ sourceURL="+(i.sourceURL||"/lodash/template/source["+w++ +"]")+"\n*/";try{var S=Bn(d,"return "+y+k).apply(n,h)}catch(T){throw T.source=y,T}return t?S(t):(S.source=y,S)}function Sn(e,t,n){e=(e=+e)>-1?e:0;var i=-1,a=Pn(e);for(t=o.createCallback(t,n,1);e>++i;)a[i]=t(i);return a}function Tn(e){return null==e?"":Hn(e).replace(d,F)}function jn(e){var t=++s;return Hn(null==e?"":e)+t}function En(e,t){return t(e),e}function $n(){return Hn(this.__wrapped__)}function Ln(){return this.__wrapped__}i=i?A.defaults(e.Object(),i,A.pick(e,y)):e;var Pn=i.Array,On=i.Boolean,An=i.Date,Bn=i.Function,In=i.Math,Rn=i.Number,Dn=i.Object,Nn=i.RegExp,Hn=i.String,Mn=i.TypeError,Wn=Pn(),qn=Dn(),zn=i._,Fn=Nn("^"+Hn(qn.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),Un=In.ceil,Kn=i.clearTimeout,Vn=Wn.concat,Xn=In.floor,Gn=Fn.test(Gn=Dn.getPrototypeOf)&&Gn,Jn=qn.hasOwnProperty,Qn=Wn.push,Zn=i.setImmediate,Yn=i.setTimeout,ei=qn.toString,ti=Fn.test(ti=z.bind)&&ti,ni=Fn.test(ni=Pn.isArray)&&ni,ii=i.isFinite,ai=i.isNaN,oi=Fn.test(oi=Dn.keys)&&oi,si=In.max,ri=In.min,li=i.parseInt,ci=In.random,ui=Fn.test(i.attachEvent),di=ti&&!/\n|true/.test(ti+ui),pi={};pi[_]=Pn,pi[C]=On,pi[k]=An,pi[j]=Dn,pi[T]=Rn,pi[E]=Nn,pi[$]=Hn;var hi=o.support={};hi.fastBind=ti&&!di,o.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:f,variable:"",imports:{_:o}};var fi=function(e){var t="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";\n";return e.arrays&&(t+="var length = iterable.length; index = -1;\nif ("+e.arrays+") {\n  while (++index < length) {\n    "+e.loop+"\n  }\n}\nelse {  "),e.useHas&&e.useKeys?t+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    "+e.loop+"\n  }  ":(t+="\n  for (index in iterable) {",e.useHas&&(t+="\n    if (",e.useHas&&(t+="hasOwnProperty.call(iterable, index)"),t+=") {    "),t+=e.loop+";    ",e.useHas&&(t+="\n    }"),t+="\n  }  "),e.arrays&&(t+="\n}"),t+=e.bottom+";\nreturn result"},gi={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},vi={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:!1,loop:"if (callback(iterable[index], index, collection) === false) return result"},mi={top:"if (!objectTypes[typeof iterable]) return result;\n"+vi.top,arrays:!1};M.prototype=o.prototype;var bi=ni||function(e){return e instanceof Pn||ei.call(e)==_},yi=D({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),wi=oi?function(e){return ot(e)?oi(e):[]}:yi,xi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_i=Q(xi),Ci=D(gi,{top:gi.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),ki=D(gi),Si=D(vi,mi,{useHas:!1}),Ti=D(vi,mi),ji=function(e){if(!e||ei.call(e)!=j)return!1;var t=e.valueOf,n="function"==typeof t&&(n=Gn(t))&&Gn(n);return n?e==n||Gn(e)==n:q(e)},Ei=xt;di&&a&&"function"==typeof Zn&&(un=an(Zn,i));var $i=8==li("08")?li:function(e,t){return li(ut(e)?e.replace(g,""):e,t||0)};return o.after=nn,o.assign=Ci,o.at=mt,o.bind=an,o.bindAll=on,o.bindKey=sn,o.compact=Nt,o.compose=rn,o.countBy=yt,o.createCallback=ln,o.debounce=cn,o.defaults=ki,o.defer=un,o.delay=dn,o.difference=Ht,o.filter=xt,o.flatten=qt,o.forEach=Ct,o.forIn=Si,o.forOwn=Ti,o.functions=G,o.groupBy=kt,o.initial=Ft,o.intersection=Ut,o.invert=Q,o.invoke=St,o.keys=wi,o.map=Tt,o.max=jt,o.memoize=pn,o.merge=pt,o.min=Et,o.omit=ht,o.once=hn,o.pairs=ft,o.partial=fn,o.partialRight=gn,o.pick=gt,o.pluck=$t,o.range=Xt,o.reject=Ot,o.rest=Gt,o.shuffle=At,o.sortBy=Rt,o.tap=En,o.throttle=vn,o.times=Sn,o.toArray=Dt,o.union=Qt,o.uniq=Zt,o.values=vt,o.where=Ei,o.without=Yt,o.wrap=mn,o.zip=en,o.zipObject=tn,o.collect=Tt,o.drop=Gt,o.each=Ct,o.extend=Ci,o.methods=G,o.object=tn,o.select=xt,o.tail=Gt,o.unique=Zt,wn(o),o.clone=K,o.cloneDeep=V,o.contains=bt,o.escape=bn,o.every=wt,o.find=_t,o.findIndex=Mt,o.findKey=X,o.has=J,o.identity=yn,o.indexOf=zt,o.isArguments=U,o.isArray=bi,o.isBoolean=Z,o.isDate=Y,o.isElement=et,o.isEmpty=tt,o.isEqual=nt,o.isFinite=it,o.isFunction=at,o.isNaN=st,o.isNull=rt,o.isNumber=lt,o.isObject=ot,o.isPlainObject=ji,o.isRegExp=ct,o.isString=ut,o.isUndefined=dt,o.lastIndexOf=Vt,o.mixin=wn,o.noConflict=xn,o.parseInt=$i,o.random=_n,o.reduce=Lt,o.reduceRight=Pt,o.result=Cn,o.runInContext=t,o.size=Bt,o.some=It,o.sortedIndex=Jt,o.template=kn,o.unescape=Tn,o.uniqueId=jn,o.all=wt,o.any=It,o.detect=_t,o.foldl=Lt,o.foldr=Pt,o.include=bt,o.inject=Lt,Ti(o,function(e,t){o.prototype[t]||(o.prototype[t]=function(){var t=[this.__wrapped__];return Qn.apply(t,arguments),e.apply(o,t)})}),o.first=Wt,o.last=Kt,o.take=Wt,o.head=Wt,Ti(o,function(e,t){o.prototype[t]||(o.prototype[t]=function(t,n){var i=e(this.__wrapped__,t,n);return null==t||n&&"function"!=typeof t?i:new M(i)})}),o.VERSION="1.1.1",o.prototype.toString=$n,o.prototype.value=Ln,o.prototype.valueOf=Ln,Ct(["join","pop","shift"],function(e){var t=Wn[e];o.prototype[e]=function(){return t.apply(this.__wrapped__,arguments)}}),Ct(["push","reverse","sort","unshift"],function(e){var t=Wn[e];o.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Ct(["concat","slice","splice"],function(e){var t=Wn[e];o.prototype[e]=function(){return new M(t.apply(this.__wrapped__,arguments))}}),o}var n,i="object"==typeof exports&&exports,a="object"==typeof module&&module&&module.exports==i&&module,o="object"==typeof global&&global;o.global===o&&(e=o);var s=0,r={},l=/\b__p \+= '';/g,c=/\b(__p \+=) '' \+/g,u=/(__e\(.*?\)|\b__t\)) \+\n'';/g,d=/&(?:amp|lt|gt|quot|#39);/g,p=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,h=/\w*$/,f=/<%=([\s\S]+?)%>/g,g=/^0+(?=.$)/,v=/($^)/,m=/[&<>"']/g,b=/['\n\r\t\u2028\u2029\\]/g,y=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],w=0,x="[object Arguments]",_="[object Array]",C="[object Boolean]",k="[object Date]",S="[object Function]",T="[object Number]",j="[object Object]",E="[object RegExp]",$="[object String]",L={};L[S]=!1,L[x]=L[_]=L[C]=L[k]=L[T]=L[j]=L[E]=L[$]=!0;var P={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},O={"\\":"\\","'":"'","\n":"n","\r":"r","    ":"t","\u2028":"u2028","\u2029":"u2029"},A=t();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(e._=A,define("underscore",[],function(){return A})):i&&!i.nodeType?a?(a.exports=A)._=A:i._=A:e._=A}(this),define("text",["module"],function(e){var t,n,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s="undefined"!=typeof location&&location.href,r=s&&location.protocol&&location.protocol.replace(/\:/,""),l=s&&location.hostname,c=s&&(location.port||void 0),u=[],d=e.config&&e.config()||{};return t={version:"2.0.5",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(a){}if(e){i=[n];break}}return e},parseName:function(e){var t,n,i,a=!1,o=e.indexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),n=e.substring(o+1,e.length)):t=e,i=n||t,o=i.indexOf("!"),-1!==o&&(a="strip"===i.substring(o+1),i=i.substring(0,o),n?n=i:t=i),{moduleName:t,ext:n,strip:a}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,a){var o,s,r,l=t.xdRegExp.exec(e);return l?(o=l[2],s=l[3],s=s.split(":"),r=s[1],s=s[0],!(o&&o!==n||s&&s.toLowerCase()!==i.toLowerCase()||(r||s)&&r!==a)):!0},finishLoad:function(e,n,i,a){i=n?t.strip(i):i,d.isBuild&&(u[e]=i),a(i)},load:function(e,n,i,a){if(a.isBuild&&!a.inlineText)return i(),void 0;d.isBuild=a.isBuild;var o=t.parseName(e),u=o.moduleName+(o.ext?"."+o.ext:""),p=n.toUrl(u),h=d.useXhr||t.useXhr;!s||h(p,r,l,c)?t.get(p,function(n){t.finishLoad(e,o.strip,n,i)},function(e){i.error&&i.error(e)}):n([u],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,i)})},write:function(e,n,i){if(u.hasOwnProperty(n)){var a=t.jsEscape(u[n]);i.asModule(e+"!"+n,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,n,i,a,o){var s=t.parseName(n),r=s.ext?"."+s.ext:"",l=s.moduleName+r,c=i.toUrl(s.moduleName+r)+".js";t.load(l,i,function(){var n=function(e){return a(c,e)};n.asModule=function(e,t){return a.asModule(e,c,t)},t.write(e,l,n,o)},o)}},"node"===d.env||!d.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var i=n.readFileSync(e,"utf8");0===i.indexOf("ï»¿")&&(i=i.substring(1)),t(i)}):"xhr"===d.env||!d.env&&t.createXhr()?t.get=function(e,n,i,a){var o,s=t.createXhr();if(s.open("GET",e,!0),a)for(o in a)a.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),a[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(){var t,a;4===s.readyState&&(t=s.status,t>399&&600>t?(a=Error(e+" HTTP status: "+t),a.xhr=s,i(a)):n(s.responseText))},s.send(null)}:("rhino"===d.env||!d.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(t.get=function(e,t){var n,i,a="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),r=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),a)),l="";try{for(n=new java.lang.StringBuffer,i=r.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),n.append(i);null!==(i=r.readLine());)n.append(s),n.append(i);l=""+n+""}finally{r.close()}t(l)}),t}),define("text!page-templates/layout-manager.html",[],function(){return'<div id="pagebuilder-fancybox" class="container">\r\n  <div class="row-fluid page-details">\r\n    <div class="span3">\r\n    <div class="widget">\r\n        <div class="head dark">\r\n            <div class="icon"><i class="icos-wrench"></i></div>\r\n            <h2>Widgets & Assets</h2>\r\n            <ul class="buttons">\r\n                <li class="popup"><a href="#" class="label"><span class="icos-help1"></span></a>\r\n\r\n                    <div class="body">\r\n                        <div class="arrow"></div>\r\n                        <div class="row-fluid">\r\n                            <div class="row-form">\r\n                                <div class="span12">\r\n                                    <span class="top">Help</span> Layout and page assets\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="block-fluid">\r\n            <div class="accordion">\r\n\r\n                <%\r\n                for (var child in widgets.list) {\r\n                    var dom = pageBuilder.objToHtmlList(widgets.list[child], widgets.id);\r\n                    var wTotal = $(\'li.asset\', dom).length;\r\n                    var badge = (wTotal > 0) ? \'\' : \'badger-danger\';\r\n                    var str = pageBuilder.outerHtml(dom);\r\n\r\n                    print(\'<h3>\' + child + \'<span class="caption blue pull-right badge \' + badge + \'">\'\r\n                        + wTotal + \'</span></h3>\');\r\n                    print(\'<div class="tree">\' + str + \'</div>\');\r\n                }\r\n                %>\r\n\r\n                <% _.each(assets, function(v, k){ var jv = $(v.items),len = (jv.length > 0) ? _.size(jv[0]) : 0;\r\n                var badge = (len > 0) ? \'\' : \'badger-danger\';\r\n                %>\r\n                <h3><%= v.title%> <span class="caption blue pull-right badge <%=badge %>"><%=len %></span></h3>\r\n\r\n                <div id="tree-<%=k %>" class="tree">\r\n                    <% if(len) {%>\r\n                    <ul id="<%=k %>">\r\n                        <li class="jstree-open"><a href="#">General</a>\r\n                            <ul class="asset-list">\r\n                                <% for(var id in v.items) { %>\r\n                                <li id="<%= k + \'-\' + id%>" class="asset layout-<%=k %>">\r\n                                    <a href="#" rel="tooltip" title="<%=v.items[id].description %>"><%=v.items[id].title\r\n                                        %></a>\r\n                                </li>\r\n                                <% }%>\r\n                            </ul>\r\n                        </li>\r\n                    </ul>\r\n                    <% } else {%>\r\n                    <p><%= k%> : No asset found</p>\r\n                    <% } %>\r\n                </div>\r\n                <% });\r\n                var len = _.size($(templates.items)[0]);\r\n                var badge = (len > 0) ? \'\' : \'badger-danger\'; ;\r\n                if(len > 0){ %>\r\n\r\n                <h3><%= templates.title%>\r\n                    <span class="caption blue pull-right badge <%=badge %>"><%=len %></span></h3>\r\n\r\n                <div>\r\n                    <ul class="template-list" id="templates">\r\n                        <% for(var id in templates.items) { %>\r\n                        <li id="templates-<%=id%>" class="asset layout-template" data-description="<%=templates.items[id].description %>">\r\n                            <button class="btn btn-mini template-clone" title="Clone template" data-layout-id="<%=id %>">\r\n                                <i class="icon-share icon"></i></button>\r\n                            <%=templates.items[id].title %>\r\n                        </li>\r\n                        <% }%>\r\n                    </ul>\r\n                </div>\r\n                <%} %>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n    <div class="span9">\r\n\r\n    <div class="widget white">\r\n        <div class="head dark">\r\n            <div class="icon"><i class="icos-article"></i></div>\r\n            <h2><%=page.title %> - <%=page.layoutType %></h2>\r\n            <ul class="buttons">\r\n             <% if(page.themes){\r\n                print(\'<li><h2>Themes</h2>\');\r\n                    print(\'<select id="themeId">\');\r\n                    print(\'<option value="">select</option>\');\r\n                        for(var i in page.themes){\r\n                            var sel = (page.themes[i].id == page.themeId) ? \'selected="selected"\' : \'\';\r\n                            print(\'<option  value="\' + page.themes[i].id + \'" \' + sel +  \'>\' + page.themes[i].title + \'</option>\');\r\n                        }\r\n                    print(\'</select>\');\r\n                print(\'</li>\');\r\n                }\r\n                %>\r\n                <li class="popup"><a href="#" class="label"><span class="icos-cog"></span></a>\r\n\r\n                    <div class="body">\r\n                        <div class="arrow"></div>\r\n                        <div class="row-fluid">\r\n                            <div class="row-form">\r\n                                <div class="span12">\r\n                                    <span class="top">Page Details</span>\r\n                                    <ul>\r\n                                        <li><strong>Title: </strong> <%=page.title %></li>\r\n                                        <li><strong>Description: </strong> <%=page.description %></li>\r\n                                        <li><strong>Template: </strong> <%=page.template %></li>\r\n                                        <li><strong>Parent: </strong>\r\n                                            <ul>\r\n                                                <li>Title: <%=page.parent %></li>\r\n                                            </ul>\r\n                                    </ul>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n                <li class="popup"><a href="#" class="label"><span class="icos-help1"></span></a>\r\n\r\n                    <div class="body">\r\n                        <div class="arrow"></div>\r\n                        <div class="row-fluid">\r\n                            <div class="row-form">\r\n                                <div class="span12">\r\n                                    <span class="top">Help</span> How to use the page layout manager\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n\r\n        <div class="block-fluid template-canvas ui-widget-content">\r\n            <% for( var sec in sections){ %>\r\n            <div id="<%=sec %>-section" class="section well bg-bottom <%=sections[sec].class %>">\r\n                <div class="pull-right badge-edit">\r\n                    <span class="badge badge-inverse">0</span>\r\n                    <button class="attr-trigger btn btn-mini"><i class="icon icon-edit"></i></button>\r\n                </div>\r\n                <label class="status"> <i class="icon icon-white icon-resize-vertical"></i> <%=sections[sec].title\r\n                    %>\r\n                </label>\r\n            </div>\r\n            <% } %>\r\n        </div>\r\n\r\n        <div class="btn-toolbar" id="action-toolbar">\r\n            <div class="btn-group template-actions block-fluid">\r\n                <button class="btn btn-mini action-btn" data-type="single">\r\n                    <i class="icon-align-justify"></i> 1 Col\r\n                </button>\r\n                <button class="btn btn-mini action-btn" data-type="3-cols">\r\n                    <i class=" icon-th"></i> 3 Cols\r\n                </button>\r\n                <button class="btn btn-mini action-btn" data-type="4-cols">\r\n                    <i class="icon-list-alt"></i> 4 Cols\r\n                </button>\r\n                <button class="btn btn-mini custom-btn action-btn" data-type="custom">\r\n                    <i class="icon-list-alt"></i> Custom\r\n                </button>\r\n            </div>\r\n\r\n            <div class="btn-group dropup template-actions block-fluid">\r\n                <button class="btn btn-mini"><i class="icon-th-large"></i> 2 Cols</button>\r\n                <button class="btn btn-mini dropdown-toggle" data-toggle="dropdown">\r\n                    <span class="caret"></span>\r\n                </button>\r\n                <ul class="dropdown-menu">\r\n                    <li>\r\n                        <a class="action-btn" data-type="2-cols-eq"> Equal </a>\r\n                    </li>\r\n                    <li>\r\n                        <a class="action-btn" data-type="2-cols-ll"> Left Large </a>\r\n                    </li>\r\n                    <li>\r\n                        <a class=" action-btn" data-type="2-cols-rl"> Right Large </a>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n\r\n            <span class="wait-image" style="display: none"><img src="/pagebuilder/img/loaders/3d_8.gif"/></span>\r\n\r\n            <div class="btn-group template-actions block-fluid pull-right">\r\n                <button class="btn btn-mini btn-danger" title="Cancel" id="close">\r\n                    <i class="icon-remove icon-white"></i> Close</button>\r\n                <button class="btn btn-mini btn-primary" title="Reset Layout" id="reset-layout" data-layout-id="0">\r\n                    <i class="icon-minus icon-white"></i> Reset</button>\r\n                <button class="btn btn-mini btn-success" id="save" data-url="<%=editUrl %>" data-page-id="<%=page.id %>"\r\n                        data-page-theme-id="<%=page.pageTheme %>">\r\n                    <i class="icon-ok icon-white"></i> Update</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n  </div>\r\n\r\n   <div id="row-data-template" style="display:none">\r\n    <div class="row-data">\r\n        <div class="handle pull-right">\r\n            <div class="btn-group">\r\n                <span class="btn btn-mini move-row" title="move row">\r\n                    <i class="icon-move icon"></i> drag to move\r\n                </span>\r\n\r\n                <span class="btn btn-mini edit-row" title="Row Attributes">\r\n                    <i class="icon-edit icon"></i>\r\n                </span>\r\n                <button class="btn btn-mini remove-row" title="delete row">\r\n                    <i class="icon-remove icon"></i>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n   <div id="item-buttons-template" style="display:none">\r\n    <div class="btn-group">\r\n        <button class="attr-trigger btn btn-mini"><i class="icon icon-edit"></i></button>\r\n        <button class="btn btn-mini item-delete"><i class="icon icon-remove"></i></button>\r\n    </div>\r\n</div>\r\n   <div id="span-template" style="display: none">\r\n    <form id="custom-selector">\r\n        <label class="custom">\r\n            <input type="text" name="span[]" value="3"/>\r\n        </label>\r\n        <label class="custom">\r\n            <input type="text" name="span[]" value="9"/>\r\n        </label>\r\n\r\n        <div class="btn-group">\r\n            <button id="cancel" class="btn btn-mini btn-danger"><i class="icon-remove icon-white"></i></button>\r\n            <button id="add" class="btn btn-mini btn-warning"><i class="icon-plus icon-white"></i></button>\r\n            <button id="ok" class="btn btn-mini btn-success"><i class="icon-ok icon-white"></i></button>\r\n        </div>\r\n    </form>\r\n</div>\r\n</div>'
}),define("text!page-templates/popover.html",[],function(){return'<div id="attr-<%=id %>">\r\n    <form class="attr-container">\r\n        <fieldset>\r\n            <legend>Main Wrapper</legend>\r\n            <div class="control">\r\n                <label>Tag</label>\r\n                <select name="wrapper" class="input-medium">\r\n                    <option value=""> -- None --</option>\r\n                    <%\r\n                    for(var a in tagList){%>\r\n                    <optgroup label="<%=a %>">\r\n                        <%\r\n                        for(var i in tagList[a]){\r\n                        var sel = (tagList[a][i] == elemTag) ? \'selected="selected"\' : \'\';%>\r\n                        <option value="<%=tagList[a][i] %>"\r\n                        <%=sel %>><%=tagList[a][i] %></option>\r\n                        <% }\r\n                        %>\r\n                    </optgroup>\r\n                    <% } %>\r\n                </select>\r\n            </div>\r\n            <div class="control">\r\n                <label>ID</label>\r\n                <input class="tags" type="text" name="id" placeholder="add ID">\r\n            </div>\r\n\r\n            <div class="control">\r\n                <label>Class</label>\r\n                <input class="tags" type="text" name="class" placeholder="add Class">\r\n            </div>\r\n\r\n\r\n            <div class="control">\r\n                <label>Attributes</label>\r\n                <input class="tags" type="text" name="attr" placeholder="add attribute">\r\n            </div>\r\n\r\n        </fieldset>\r\n\r\n        <fieldset>\r\n            <legend>Inner Wrappers</legend>\r\n            <div class="control">\r\n                <label>Level 1</label>\r\n                <input class="tags" type="text" name="container" placeholder="add class">\r\n            </div>\r\n            <div class="control">\r\n                <label>Level 2</label>\r\n                <input class="tags" type="text" name="container2" placeholder="add class">\r\n            </div>\r\n\r\n        </fieldset>\r\n        <% if(_.size( $(options)[0])){%>\r\n        <fieldset>\r\n            <legend>Additional Options</legend>\r\n\r\n            <div class="control">\r\n                <%\r\n                for(var o in options){ %>\r\n                <label><%=o %></label>\r\n                <input class="tags" type="text" name="options_<%=o %>" placeholder="add <%=o %>" value="<%=options[o] %>">\r\n                <%}\r\n                %>\r\n            </div>\r\n        </fieldset>\r\n        <% } %>\r\n        <div class="btn-group pull-right">\r\n            <button id="pop-cancel" class="btn btn-mini btn-danger"><i class="icon-remove icon-white"></i></button>\r\n            <button id="pop-ok" class="btn btn-mini btn-success"><i class="icon-ok icon-white"></i></button>\r\n        </div>\r\n    </form>\r\n</div>'}),define("text!page-templates/sections.html",[],function(){return'<div id="show-sections" title="Template Sections" class="temp">\r\n    <div>\r\n        <form action="<%=updateUrl %>" method="post">\r\n            <select name="sectionId" multiple="true" class="multiselect" style=\'height:300px; width:450px\'>\r\n                <%\r\n                var sel = \'\';\r\n                for(var i in sections){\r\n                    if(_.has(sections, i)){\r\n                        var v  = i * 1;\r\n                        sel = _.contains(templateSections, v) ?  \' selected="selected" \' : \'\' ; %>\r\n                        <option <%=sel %> value="<%=i %>"><%=sections[i].title %></option>\r\n                <%  }\r\n                }\r\n\r\n                %>\r\n            </select>\r\n        </form>\r\n    </div>\r\n</div>'}),function(e){e.widget("ui.multiselect",{_init:function(){this.element.hide(),this.id=this.element.attr("id"),this.container=e('<div class="ui-multiselect ui-helper-clearfix ui-widget"></div>').insertAfter(this.element),this.count=0,this.selectedContainer=e('<div class="selected"></div>').appendTo(this.container),this.availableContainer=e('<div class="available"></div>').appendTo(this.container),this.selectedActions=e('<div class="actions ui-widget-header ui-helper-clearfix"><span class="count">0 '+e.ui.multiselect.locale.itemsCount+'</span><a href="#" class="remove-all">'+e.ui.multiselect.locale.removeAll+"</a></div>").appendTo(this.selectedContainer),this.availableActions=e('<div class="actions ui-widget-header ui-helper-clearfix"><input type="text" class="search empty ui-widget-content ui-corner-all"/><a href="#" class="add-all">'+e.ui.multiselect.locale.addAll+"</a></div>").appendTo(this.availableContainer),this.selectedList=e('<ul class="selected connected-list"><li class="ui-helper-hidden-accessible"></li></ul>').bind("selectstart",function(){return!1}).appendTo(this.selectedContainer),this.availableList=e('<ul class="available connected-list"><li class="ui-helper-hidden-accessible"></li></ul>').bind("selectstart",function(){return!1}).appendTo(this.availableContainer);var t=this;this.container.width(this.element.width()+1),this.selectedContainer.width(Math.floor(this.element.width()*this.options.dividerLocation)),this.availableContainer.width(Math.floor(this.element.width()*(1-this.options.dividerLocation))),this.selectedList.height(Math.max(this.element.height()-this.selectedActions.height(),1)),this.availableList.height(Math.max(this.element.height()-this.availableActions.height(),1)),this.options.animated||(this.options.show="show",this.options.hide="hide"),this._populateLists(this.element.find("option")),this.options.sortable&&e("ul.selected").sortable({placeholder:"ui-state-highlight",axis:"y",update:function(){t.selectedList.find("li").each(function(){e(this).data("optionLink")&&e(this).data("optionLink").remove().appendTo(t.element)})},receive:function(n,i){i.item.data("optionLink").attr("selected",!0),t.count+=1,t._updateCount(),t.selectedList.children(".ui-draggable").each(function(){e(this).removeClass("ui-draggable"),e(this).data("optionLink",i.item.data("optionLink")),e(this).data("idx",i.item.data("idx")),t._applyItemState(e(this),!0)}),setTimeout(function(){i.item.remove()},1)}}),this.options.searchable?this._registerSearchEvents(this.availableContainer.find("input.search")):e(".search").hide(),e(".remove-all").click(function(){return t._populateLists(t.element.find("option").removeAttr("selected")),!1}),e(".add-all").click(function(){return t._populateLists(t.element.find("option").attr("selected","selected")),!1})},destroy:function(){this.element.show(),this.container.remove(),e.widget.prototype.destroy.apply(this,arguments)},_populateLists:function(t){this.selectedList.children(".ui-element").remove(),this.availableList.children(".ui-element").remove(),this.count=0;var n=this;e(t.map(function(e){var t=n._getOptionNode(this).appendTo(this.selected?n.selectedList:n.availableList).show();return this.selected&&(n.count+=1),n._applyItemState(t,this.selected),t.data("idx",e),t[0]})),this._updateCount()},_updateCount:function(){this.selectedContainer.find("span.count").text(this.count+" "+e.ui.multiselect.locale.itemsCount)},_getOptionNode:function(t){t=e(t);var n=e('<li class="ui-state-default ui-element" title="'+t.text()+'"><span class="ui-icon"/>'+t.text()+'<a href="#" class="action"><span class="ui-corner-all ui-icon"/></a></li>').hide();return n.data("optionLink",t),n},_cloneWithData:function(e){var t=e.clone();return t.data("optionLink",e.data("optionLink")),t.data("idx",e.data("idx")),t},_setSelected:function(t,n){if(t.data("optionLink").attr("selected",n),n){var i=this._cloneWithData(t);return t[this.options.hide](this.options.animated,function(){e(this).remove()}),i.appendTo(this.selectedList).hide()[this.options.show](this.options.animated),this._applyItemState(i,!0),i}var a=this.availableList.find("li"),o=this.options.nodeComparator,s=null,r=t.data("idx"),l=o(t,e(a[r]));if(l){for(;r>=0&&a.length>r;)if(l>0?r++:r--,l!=o(t,e(a[r]))){s=a[l>0?r:r+1];break}}else s=a[r];var c=this._cloneWithData(t);return s?c.insertBefore(e(s)):c.appendTo(this.availableList),t[this.options.hide](this.options.animated,function(){e(this).remove()}),c.hide()[this.options.show](this.options.animated),this._applyItemState(c,!1),c},_applyItemState:function(e,t){t?(this.options.sortable?e.children("span").addClass("ui-icon-arrowthick-2-n-s").removeClass("ui-helper-hidden").addClass("ui-icon"):e.children("span").removeClass("ui-icon-arrowthick-2-n-s").addClass("ui-helper-hidden").removeClass("ui-icon"),e.find("a.action span").addClass("ui-icon-minus").removeClass("ui-icon-plus"),this._registerRemoveEvents(e.find("a.action"))):(e.children("span").removeClass("ui-icon-arrowthick-2-n-s").addClass("ui-helper-hidden").removeClass("ui-icon"),e.find("a.action span").addClass("ui-icon-plus").removeClass("ui-icon-minus"),this._registerAddEvents(e.find("a.action"))),this._registerHoverEvents(e)},_filter:function(t){var n=e(this),i=t.children("li"),a=i.map(function(){return e(this).text().toLowerCase()}),o=e.trim(n.val().toLowerCase()),s=[];o?(i.hide(),a.each(function(e){this.indexOf(o)>-1&&s.push(e)}),e.each(s,function(){e(i[this]).show()})):i.show()},_registerHoverEvents:function(t){t.removeClass("ui-state-hover"),t.mouseover(function(){e(this).addClass("ui-state-hover")}),t.mouseout(function(){e(this).removeClass("ui-state-hover")})},_registerAddEvents:function(t){var n=this;t.click(function(){return n._setSelected(e(this).parent(),!0),n.count+=1,n._updateCount(),!1}).each(function(){e(this).parent().draggable({connectToSortable:"ul.selected",helper:function(){var t=n._cloneWithData(e(this)).width(e(this).width()-50);return t.width(e(this).width()),t},appendTo:".ui-multiselect",containment:".ui-multiselect",revert:"invalid"})})},_registerRemoveEvents:function(t){var n=this;t.click(function(){return n._setSelected(e(this).parent(),!1),n.count-=1,n._updateCount(),!1})},_registerSearchEvents:function(t){var n=this;t.focus(function(){e(this).addClass("ui-state-active")}).blur(function(){e(this).removeClass("ui-state-active")}).keypress(function(e){return 13==e.keyCode?!1:void 0}).keyup(function(){n._filter.apply(this,[n.availableList])})}}),e.extend(e.ui.multiselect,{defaults:{sortable:!0,searchable:!0,animated:"fast",show:"slideDown",hide:"slideUp",dividerLocation:.6,nodeComparator:function(e,t){var n=e.text(),i=t.text();return n==i?0:i>n?-1:1}},locale:{addAll:"Add all",removeAll:"Remove all",itemsCount:"items selected"}})}(jQuery),function(e){var t=[],n=[];e.fn.doAutosize=function(t){var n=e(this).data("minwidth"),i=e(this).data("maxwidth"),a="",o=e(this),s=e("#"+e(this).data("tester_id"));if(a!==(a=o.val())){var r=a.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">");s.html(r);var l=s.width(),c=l+t.comfortZone>=n?l+t.comfortZone:n,u=o.width(),d=u>c&&c>=n||c>n&&i>c;d&&o.width(c)}},e.fn.resetAutosize=function(t){var n=e(this).data("minwidth")||t.minInputWidth||e(this).width(),i=e(this).data("maxwidth")||t.maxInputWidth||e(this).closest(".tagsinput").width()-t.inputPadding,a=e(this),o=e("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:a.css("fontSize"),fontFamily:a.css("fontFamily"),fontWeight:a.css("fontWeight"),letterSpacing:a.css("letterSpacing"),whiteSpace:"nowrap"}),s=e(this).attr("id")+"_autosize_tester";!e("#"+s).length>0&&(o.attr("id",s),o.appendTo("body")),a.data("minwidth",n),a.data("maxwidth",i),a.data("tester_id",s),a.css("width",n)},e.fn.addTag=function(i,a){return a=jQuery.extend({focus:!1,callback:!0},a),this.each(function(){var o=e(this).attr("id"),s=e(this).val().split(t[o]);if(""==s[0]&&(s=[]),i=jQuery.trim(i),a.unique){var r=e(s).tagExist(i);1==r&&e("#"+o+"_tag").addClass("not_valid")}else var r=!1;if(""!=i&&1!=r){if(e("<span>").addClass("tag").append(e("<span>").text(i).append("Â Â "),e("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return e("#"+o).removeTag(escape(i))})).insertBefore("#"+o+"_addTag"),s.push(i),e("#"+o+"_tag").val(""),a.focus?e("#"+o+"_tag").focus():e("#"+o+"_tag").blur(),e.fn.tagsInput.updateTagsField(this,s),a.callback&&n[o]&&n[o].onAddTag){var l=n[o].onAddTag;l.call(this,i)}if(n[o]&&n[o].onChange){var c=s.length,l=n[o].onChange;l.call(this,e(this),s[c-1])}}}),!1},e.fn.removeTag=function(a){return a=unescape(a),this.each(function(){var o=e(this).attr("id"),s=e(this).val().split(t[o]);for(e("#"+o+"_tagsinput .tag").remove(),str="",i=0;s.length>i;i++)s[i]!=a&&(str=str+t[o]+s[i]);if(e.fn.tagsInput.importTags(this,str),n[o]&&n[o].onRemoveTag){var r=n[o].onRemoveTag;r.call(this,a)}}),!1},e.fn.tagExist=function(t){return jQuery.inArray(t,e(this))>=0},e.fn.importTags=function(t){id=e(this).attr("id"),e("#"+id+"_tagsinput .tag").remove(),e.fn.tagsInput.importTags(this,t)},e.fn.tagsInput=function(i){var a=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},i);return this.each(function(){a.hide&&e(this).hide();var i=e(this).attr("id");(!i||t[e(this).attr("id")])&&(i=e(this).attr("id","tags"+(new Date).getTime()).attr("id"));var o=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},a);t[i]=o.delimiter,(a.onAddTag||a.onRemoveTag||a.onChange)&&(n[i]=[],n[i].onAddTag=a.onAddTag,n[i].onRemoveTag=a.onRemoveTag,n[i].onChange=a.onChange);var s='<div id="'+i+'_tagsinput" class="tagsinput"><div id="'+i+'_addTag">';if(a.interactive&&(s=s+'<input id="'+i+'_tag" value="" data-default="'+a.defaultText+'" />'),s+='</div><div class="tags_clear"></div></div>',e(s).insertAfter(this),e(o.holder).css("width",a.width),e(o.holder).css("height",a.height),""!=e(o.real_input).val()&&e.fn.tagsInput.importTags(e(o.real_input),e(o.real_input).val()),a.interactive){if(e(o.fake_input).val(e(o.fake_input).attr("data-default")),e(o.fake_input).css("color",a.placeholderColor),e(o.fake_input).resetAutosize(a),e(o.holder).bind("click",o,function(t){e(t.data.fake_input).focus()}),e(o.fake_input).bind("focus",o,function(t){e(t.data.fake_input).val()==e(t.data.fake_input).attr("data-default")&&e(t.data.fake_input).val(""),e(t.data.fake_input).css("color","#000000")}),void 0!=a.autocomplete_url){autocomplete_options={source:a.autocomplete_url};for(attrname in a.autocomplete)autocomplete_options[attrname]=a.autocomplete[attrname];void 0!==jQuery.Autocompleter?(e(o.fake_input).autocomplete(a.autocomplete_url,a.autocomplete),e(o.fake_input).bind("result",o,function(t,n){n&&e("#"+i).addTag(n[0]+"",{focus:!0,unique:a.unique})})):void 0!==jQuery.ui.autocomplete&&(e(o.fake_input).autocomplete(autocomplete_options),e(o.fake_input).bind("autocompleteselect",o,function(t,n){return e(t.data.real_input).addTag(n.item.value,{focus:!0,unique:a.unique}),!1}))}else e(o.fake_input).bind("blur",o,function(t){var n=e(this).attr("data-default");return""!=e(t.data.fake_input).val()&&e(t.data.fake_input).val()!=n?t.data.minChars<=e(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=e(t.data.fake_input).val().length)&&e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:!0,unique:a.unique}):(e(t.data.fake_input).val(e(t.data.fake_input).attr("data-default")),e(t.data.fake_input).css("color",a.placeholderColor)),!1});e(o.fake_input).bind("keypress",o,function(t){return t.which==t.data.delimiter.charCodeAt(0)||13==t.which?(t.preventDefault(),t.data.minChars<=e(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=e(t.data.fake_input).val().length)&&e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:!0,unique:a.unique}),e(t.data.fake_input).resetAutosize(a),!1):(t.data.autosize&&e(t.data.fake_input).doAutosize(a),void 0)}),o.removeWithBackspace&&e(o.fake_input).bind("keydown",function(t){if(8==t.keyCode&&""==e(this).val()){t.preventDefault();var n=e(this).closest(".tagsinput").find(".tag:last").text(),i=e(this).attr("id").replace(/_tag$/,"");n=n.replace(/[\s]+x$/,""),e("#"+i).removeTag(escape(n)),e(this).trigger("focus")}}),e(o.fake_input).blur(),o.unique&&e(o.fake_input).keydown(function(t){(8==t.keyCode||String.fromCharCode(t.which).match(/\w+|[Ã¡Ã©Ã­Ã³ÃºÃÃÃÃÃÃ±Ã,/]+/))&&e(this).removeClass("not_valid")})}}),this},e.fn.tagsInput.updateTagsField=function(n,i){var a=e(n).attr("id");e(n).val(i.join(t[a]))},e.fn.tagsInput.importTags=function(a,o){e(a).val("");var s=e(a).attr("id"),r=o.split(t[s]);for(i=0;r.length>i;i++)e(a).addTag(r[i],{focus:!1,callback:!1});if(n[s]&&n[s].onChange){var l=n[s].onChange;l.call(a,a,r[i])}}}(jQuery),function(e){e.fn.each2===void 0&&e.fn.extend({each2:function(t){for(var n=e([0]),i=-1,a=this.length;a>++i&&(n.context=n[0]=this[i])&&!1!==t.call(n[0],i,n););return this}})}(jQuery),function(e,t){function n(e,t){var n,i=0,a=t.length;if(e===void 0)return-1;if(e.constructor===String){for(;a>i;i+=1)if(0===e.localeCompare(t[i]))return i}else for(;a>i;i+=1)if(n=t[i],n.constructor===String){if(0===n.localeCompare(e))return i}else if(n===e)return i;return-1}function i(e,n){return e===n?!0:e===t||n===t||null===e||null===n?!1:e.constructor===String?0===e.localeCompare(n):n.constructor===String?0===n.localeCompare(e):!1}function a(t,n){var i,a,o;if(null===t||1>t.length)return[];for(i=t.split(n),a=0,o=i.length;o>a;a+=1)i[a]=e.trim(i[a]);return i}function o(e,n,i){var a,i=i||t;return function(){var t=arguments;window.clearTimeout(a),a=window.setTimeout(function(){n.apply(i,t)},e)}}function s(e){e.preventDefault(),e.stopPropagation()}function r(e,t,n){var i=e.toUpperCase().indexOf(t.toUpperCase()),t=t.length;0>i?n.push(e):(n.push(e.substring(0,i)),n.push("<span class='select2-match'>"),n.push(e.substring(i,i+t)),n.push("</span>"),n.push(e.substring(i+t,e.length)))}function l(t){var n,i=0,a=null,o=t.quietMillis||100;return function(s){window.clearTimeout(n),n=window.setTimeout(function(){var n=i+=1,o=t.data,r=t.transport||e.ajax,l=t.traditional||!1,c=t.type||"GET",o=o.call(this,s.term,s.page,s.context);null!==a&&a.abort(),a=r.call(null,{url:t.url,dataType:t.dataType,data:o,type:c,traditional:l,success:function(e){i>n||(e=t.results(e,s.page),s.callback(e))}})},o)}}function c(t){var n,i=t,a=function(e){return""+e.text};return e.isArray(i)||(a=i.text,e.isFunction(a)||(n=i.text,a=function(e){return e[n]}),i=i.results),function(t){var n,o=t.term,s={results:[]};""===o?t.callback({results:i}):(n=function(i,s){var r,l,i=i[0];if(i.children){r={};for(l in i)i.hasOwnProperty(l)&&(r[l]=i[l]);r.children=[],e(i.children).each2(function(e,t){n(t,r.children)}),r.children.length&&s.push(r)}else t.matcher(o,a(i))&&s.push(i)},e(i).each2(function(e,t){n(t,s.results)}),t.callback(s))}}function u(n){return e.isFunction(n)?n:function(i){var a=i.term,o={results:[]};e(n).each(function(){var e=this.text!==t,n=e?this.text:this;(""===a||i.matcher(a,n))&&o.results.push(e?this:{id:this,text:this})}),i.callback(o)}}function d(t){if(e.isFunction(t))return!0;if(!t)return!1;throw Error("formatterName must be a function or a falsy value")}function p(t){return e.isFunction(t)?t():t}function h(t){var n=0;return e.each(t,function(e,t){t.children?n+=h(t.children):n++}),n}function f(e,n,a,o){var s,r,l,c,u=e,d=!1;if(!o.createSearchChoice||!o.tokenSeparators||1>o.tokenSeparators.length)return t;for(;;){for(d=-1,r=0,l=o.tokenSeparators.length;l>r&&(c=o.tokenSeparators[r],d=e.indexOf(c),!(d>=0));r++);if(0>d)break;if(s=e.substring(0,d),e=e.substring(d+c.length),s.length>0&&(s=o.createSearchChoice(s,n),s!==t&&null!==s&&o.id(s)!==t&&null!==o.id(s))){for(d=!1,r=0,l=n.length;l>r;r++)if(i(o.id(s),o.id(n[r]))){d=!0;break}d||a(s)}}return 0!=u.localeCompare(e)?e:void 0}function g(t,n){var i=function(){};return i.prototype=new t,i.prototype.constructor=i,i.prototype.parent=t.prototype,i.prototype=e.extend(i.prototype,n),i}if(window.Select2===t){var v,m,b,y,w,x;v={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case v.LEFT:case v.RIGHT:case v.UP:case v.DOWN:return!0}return!1},isControl:function(e){switch(e.which){case v.SHIFT:case v.CTRL:case v.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e}};var _=1;w=function(){return _++},e(document).delegate("body","mousemove",function(t){e.data(document,"select2-lastpos",{x:t.pageX,y:t.pageY})}),e(document).ready(function(){e(document).delegate("body","mousedown touchend",function(n){var i,a=e(n.target).closest("div.select2-container").get(0);a?e(document).find("div.select2-container-active").each(function(){this!==a&&e(this).data("select2").blur()}):(a=e(n.target).closest("div.select2-drop").get(0),e(document).find("div.select2-drop-active").each(function(){this!==a&&e(this).data("select2").blur()})),a=e(n.target),i=a.attr("for"),"LABEL"===n.target.tagName&&i&&i.length>0&&(a=e("#"+i),a=a.data("select2"),a!==t&&(a.focus(),n.preventDefault()))})}),m=g(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(i){var a,r;this.opts=i=this.prepareOpts(i),this.id=i.id,i.element.data("select2")!==t&&null!==i.element.data("select2")&&this.destroy(),this.enabled=!0,this.container=this.createContainer(),this.containerId="s2id_"+(i.element.attr("id")||"autogen"+w()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId);var l,c=!1;this.body=function(){return!1===c&&(l=i.element.closest("body"),c=!0),l},i.element.attr("class")!==t&&this.container.addClass(i.element.attr("class").replace(/validate\[[\S ]+] ?/,"")),this.container.css(p(i.containerCss)),this.container.addClass(p(i.containerCssClass)),this.opts.element.data("select2",this).hide().before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(p(i.dropdownCssClass)),this.dropdown.data("select2",this),this.results=a=this.container.find(".select2-results"),this.search=r=this.container.find("input.select2-input"),r.attr("tabIndex",this.opts.element.attr("tabIndex")),this.resultsPage=0,this.context=null,this.initContainer(),this.initContainerWidth(),this.results.bind("mousemove",function(n){var i=e.data(document,"select2-lastpos");(i===t||i.x!==n.pageX||i.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)}),this.dropdown.delegate(".select2-results","mousemove-filtered",this.bind(this.highlightUnderEvent));var u=this.results,d=o(80,function(e){u.trigger("scroll-debounced",e)});u.bind("scroll",function(e){n(e.target,u.get())>=0&&d(e)}),this.dropdown.delegate(".select2-results","scroll-debounced",this.bind(this.loadMoreIfNeeded)),e.fn.mousewheel&&a.mousewheel(function(e,t,n,i){t=a.scrollTop(),i>0&&0>=t-i?(a.scrollTop(0),s(e)):0>i&&a.get(0).scrollHeight-a.scrollTop()+i<=a.height()&&(a.scrollTop(a.get(0).scrollHeight-a.height()),s(e))}),r.bind("keydown",function(){e.data(r,"keyup-change-value")===t&&e.data(r,"keyup-change-value",r.val())}),r.bind("keyup",function(){var n=e.data(r,"keyup-change-value");n!==t&&r.val()!==n&&(e.removeData(r,"keyup-change-value"),r.trigger("keyup-change"))}),r.bind("keyup-change",this.bind(this.updateResults)),r.bind("focus",function(){r.addClass("select2-focused")," "===r.val()&&r.val("")}),r.bind("blur",function(){r.removeClass("select2-focused")}),this.dropdown.delegate(".select2-results","mouseup",this.bind(function(t){e(t.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0?(this.highlightUnderEvent(t),this.selectHighlighted(t)):this.focusSearch(),s(t)})),this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation()}),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),(i.element.is(":disabled")||i.element.is("[readonly='readonly']"))&&this.disable()},destroy:function(){var e=this.opts.element.data("select2");e!==t&&(e.container.remove(),e.dropdown.remove(),e.opts.element.removeData("select2").unbind(".select2").show())},prepareOpts:function(n){var o,s,r;if(o=n.element,"select"===o.get(0).tagName.toLowerCase()&&(this.select=s=n.element),s&&e.each("id multiple ajax query createSearchChoice initSelection data tags".split(" "),function(){if(this in n)throw Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),n=e.extend({},{populateResults:function(i,a,o){var s,r=this.opts.id,l=this;s=function(i,a,c){var u,d,p,h,f,g,v;for(u=0,d=i.length;d>u;u+=1)p=i[u],h=r(p)!==t,f=p.children&&p.children.length>0,g=e("<li></li>"),g.addClass("select2-results-dept-"+c),g.addClass("select2-result"),g.addClass(h?"select2-result-selectable":"select2-result-unselectable"),f&&g.addClass("select2-result-with-children"),g.addClass(l.opts.formatResultCssClass(p)),h=e("<div></div>"),h.addClass("select2-result-label"),v=n.formatResult(p,h,o),v!==t&&h.html(l.opts.escapeMarkup(v)),g.append(h),f&&(f=e("<ul></ul>"),f.addClass("select2-result-sub"),s(p.children,f,c+1),g.append(f)),g.data("select2-data",p),a.append(g)},s(a,i,0)}},e.fn.select2.defaults,n),"function"!=typeof n.id&&(r=n.id,n.id=function(e){return e[r]}),s?(n.query=this.bind(function(n){var i,a,s,r={results:[],more:!1},l=n.term;s=function(e,t){var i;e.is("option")?n.matcher(l,e.text(),e)&&t.push({id:e.attr("value"),text:e.text(),element:e.get(),css:e.attr("class")}):e.is("optgroup")&&(i={text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")},e.children().each2(function(e,t){s(t,i.children)}),i.children.length>0&&t.push(i))},i=o.children(),this.getPlaceholder()!==t&&i.length>0&&(a=i[0],""===e(a).text()&&(i=i.not(a))),i.each2(function(e,t){s(t,r.results)}),n.callback(r)}),n.id=function(e){return e.id},n.formatResultCssClass=function(e){return e.css}):"query"in n||("ajax"in n?((s=n.element.data("ajax-url"))&&s.length>0&&(n.ajax.url=s),n.query=l(n.ajax)):"data"in n?n.query=c(n.data):"tags"in n&&(n.query=u(n.tags),n.createSearchChoice=function(e){return{id:e,text:e}},n.initSelection=function(t,o){var s=[];e(a(t.val(),n.separator)).each(function(){var t=this,a=this,o=n.tags;e.isFunction(o)&&(o=o()),e(o).each(function(){return i(this.id,t)?(a=this.text,!1):void 0}),s.push({id:t,text:a})}),o(s)})),"function"!=typeof n.query)throw"query function not defined for Select2 "+n.element.attr("id");return n},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(){!0!==this.opts.element.data("select2-change-triggered")&&this.initSelection()}))},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},enable:function(){this.enabled||(this.enabled=!0,this.container.removeClass("select2-container-disabled"))},disable:function(){this.enabled&&(this.close(),this.enabled=!1,this.container.addClass("select2-container-disabled"))},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t,n=this.container.offset(),i=this.container.outerHeight(),a=this.container.outerWidth(),o=this.dropdown.outerHeight(),s=e(window).scrollTop()+document.documentElement.clientHeight,i=n.top+i,r=n.left,s=s>=i+o,l=n.top-o>=this.body().scrollTop(),c=this.dropdown.hasClass("select2-drop-above");"static"!==this.body().css("position")&&(t=this.body().offset(),i-=t.top,r-=t.left),c?(c=!0,!l&&s&&(c=!1)):(c=!1,!s&&l&&(c=!0)),c?(i=n.top-o,this.container.addClass("select2-drop-above"),this.dropdown.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")),n=e.extend({top:i,left:r,width:a},p(this.opts.dropdownCss)),this.dropdown.css(n)},shouldOpen:function(){var t;return this.opened()?!1:(t=e.Event("open"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(window.setTimeout(this.bind(this.opening),1),!0):!1},opening:function(){var t=this.containerId,n=this.containerSelector,i="scroll."+t,a="resize."+t;this.container.parents().each(function(){e(this).bind(i,function(){var t=e(n);0==t.length&&e(this).unbind(i),t.select2("close")})}),e(window).bind(a,function(){var t=e(n);0==t.length&&e(window).unbind(a),t.select2("close")}),this.clearDropdownAlignmentPreference()," "===this.search.val()&&this.search.val(""),this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.updateResults(!0),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active"),this.ensureHighlightVisible(),this.focusSearch()},close:function(){if(this.opened()){var t=this;this.container.parents().each(function(){e(this).unbind("scroll."+t.containerId)}),e(window).unbind("resize."+this.containerId),this.clearDropdownAlignmentPreference(),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.opts.element.trigger(e.Event("close"))}},clearSearch:function(){},ensureHighlightVisible:function(){var t,n,i,a,o=this.results;n=this.highlight(),0>n||(0==n?o.scrollTop(0):(t=o.find(".select2-result-selectable"),i=e(t[n]),a=i.offset().top+i.outerHeight(),n===t.length-1&&(t=o.find("li.select2-more-results"),t.length>0&&(a=t.offset().top+t.outerHeight())),t=o.offset().top+o.outerHeight(),a>t&&o.scrollTop(o.scrollTop()+(a-t)),i=i.offset().top-o.offset().top,0>i&&o.scrollTop(o.scrollTop()+i)))},moveHighlight:function(t){for(var n=this.results.find(".select2-result-selectable"),i=this.highlight();i>-1&&n.length>i;){var i=i+t,a=e(n[i]);if(a.hasClass("select2-result-selectable")&&!a.hasClass("select2-disabled")){this.highlight(i);break}}},highlight:function(t){var i=this.results.find(".select2-result-selectable").not(".select2-disabled");return 0===arguments.length?n(i.filter(".select2-highlighted")[0],i.get()):(t>=i.length&&(t=i.length-1),0>t&&(t=0),i.removeClass("select2-highlighted"),e(i[t]).addClass("select2-highlighted"),this.ensureHighlightVisible(),void 0)},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length},highlightUnderEvent:function(t){if(t=e(t.target).closest(".select2-result-selectable"),t.length>0&&!t.is(".select2-highlighted")){var n=this.results.find(".select2-result-selectable");this.highlight(n.index(t))}else 0==t.length&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e,t=this.results,n=t.find("li.select2-more-results"),i=this.resultsPage+1,a=this,o=this.search.val(),s=this.context;0!==n.length&&(e=n.offset().top-t.offset().top-t.height(),0>=e&&(n.addClass("select2-active"),this.opts.query({term:o,page:i,context:s,matcher:this.opts.matcher,callback:this.bind(function(e){a.opened()&&(a.opts.populateResults.call(this,t,e.results,{term:o,page:i,context:s}),!0===e.more?(n.detach().appendTo(t).text(a.opts.formatLoadMore(i+1)),window.setTimeout(function(){a.loadMoreIfNeeded()},10)):n.remove(),a.positionDropdown(),a.resultsPage=i)})})))},tokenize:function(){},updateResults:function(n){function a(){l.scrollTop(0),r.removeClass("select2-active"),u.positionDropdown()}function o(e){l.html(u.opts.escapeMarkup(e)),a()}var s,r=this.search,l=this.results,c=this.opts,u=this;if(!0===n||!1!==this.showSearchInput&&this.opened()){if(r.addClass("select2-active"),c.maximumSelectionSize>=1&&(s=this.data(),e.isArray(s)&&s.length>=c.maximumSelectionSize&&d(c.formatSelectionTooBig,"formatSelectionTooBig")))return o("<li class='select2-selection-limit'>"+c.formatSelectionTooBig(c.maximumSelectionSize)+"</li>"),void 0;
r.val().length<c.minimumInputLength&&d(c.formatInputTooShort,"formatInputTooShort")?o("<li class='select2-no-results'>"+c.formatInputTooShort(r.val(),c.minimumInputLength)+"</li>"):(o("<li class='select2-searching'>"+c.formatSearching()+"</li>"),s=this.tokenize(),s!=t&&null!=s&&r.val(s),this.resultsPage=1,c.query({term:r.val(),page:this.resultsPage,context:null,matcher:c.matcher,callback:this.bind(function(s){var p;this.opened()&&(this.context=s.context===t?null:s.context,this.opts.createSearchChoice&&""!==r.val()&&(p=this.opts.createSearchChoice.call(null,r.val(),s.results),p!==t&&null!==p&&u.id(p)!==t&&null!==u.id(p)&&0===e(s.results).filter(function(){return i(u.id(this),u.id(p))}).length&&s.results.unshift(p)),0===s.results.length&&d(c.formatNoMatches,"formatNoMatches")?o("<li class='select2-no-results'>"+c.formatNoMatches(r.val())+"</li>"):(l.empty(),u.opts.populateResults.call(this,l,s.results,{term:r.val(),page:this.resultsPage,context:null}),!0===s.more&&d(c.formatLoadMore,"formatLoadMore")&&(l.append("<li class='select2-more-results'>"+u.opts.escapeMarkup(c.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){u.loadMoreIfNeeded()},10)),this.postprocessResults(s,n),a()))})}))}},cancel:function(){this.close()},blur:function(){this.close(),this.container.removeClass("select2-container-active"),this.dropdown.removeClass("select2-drop-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){this.search.show(),this.search.focus(),window.setTimeout(this.bind(function(){this.search.show(),this.search.focus(),this.search.val(this.search.val())}),10)},selectHighlighted:function(){var e=this.highlight(),t=this.results.find(".select2-highlighted").not(".select2-disabled"),n=t.closest(".select2-result-selectable").data("select2-data");n&&(t.addClass("select2-disabled"),this.highlight(e),this.onSelect(n))},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){var n=function(){var n,i,a,o;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth()?"auto":this.opts.element.outerWidth()+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if(n=this.opts.element.attr("style"),n!==t)for(n=n.split(";"),a=0,o=n.length;o>a;a+=1)if(i=n[a].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/),null!==i&&i.length>=1)return i[1];return"resolve"===this.opts.width?(n=this.opts.element.css("width"),n.indexOf("%")>0?n:0===this.opts.element.outerWidth()?"auto":this.opts.element.outerWidth()+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}.call(this);null!==n&&this.container.attr("style","width: "+n)}}),b=g(m,{createContainer:function(){return e("<div></div>",{"class":"select2-container"}).html("    <a href='#' onclick='return false;' class='select2-choice'>   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>   <div><b></b></div></a>    <div class='select2-drop select2-offscreen'>   <div class='select2-search'>       <input type='text' autocomplete='off' class='select2-input'/>   </div>   <ul class='select2-results'>   </ul></div>")},opening:function(){this.search.show(),this.parent.opening.apply(this,arguments),this.dropdown.removeClass("select2-offscreen")},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show())},focus:function(){this.close(),this.selection.focus()},isFocused:function(){return this.selection[0]===document.activeElement},cancel:function(){this.parent.cancel.apply(this,arguments),this.selection.focus()},initContainer:function(){var e,t=this.dropdown;this.selection=e=this.container.find(".select2-choice"),this.search.bind("keydown",this.bind(function(e){if(this.enabled)if(e.which===v.PAGE_UP||e.which===v.PAGE_DOWN)s(e);else if(this.opened())switch(e.which){case v.UP:case v.DOWN:this.moveHighlight(e.which===v.UP?-1:1),s(e);break;case v.TAB:case v.ENTER:this.selectHighlighted(),s(e);break;case v.ESC:this.cancel(e),s(e)}else e.which===v.TAB||v.isControl(e)||v.isFunctionKey(e)||e.which===v.ESC||!1===this.opts.openOnEnter&&e.which===v.ENTER||this.open()})),this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1")})),this.search.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.selection.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("mousedown",this.bind(function(){this.opened()?(this.close(),this.selection.focus()):this.enabled&&this.open()})),t.bind("mousedown",this.bind(function(){this.search.focus()})),e.bind("focus",this.bind(function(){this.container.addClass("select2-container-active"),this.search.attr("tabIndex","-1")})),e.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("keydown",this.bind(function(e){if(this.enabled)if(e.which===v.PAGE_UP||e.which===v.PAGE_DOWN)s(e);else if(!(e.which===v.TAB||v.isControl(e)||v.isFunctionKey(e)||e.which===v.ESC||!1===this.opts.openOnEnter&&e.which===v.ENTER))if(e.which==v.DELETE)this.opts.allowClear&&this.clear();else{if(this.open(),e.which!==v.ENTER&&!(48>e.which)){var t=String.fromCharCode(e.which).toLowerCase();e.shiftKey&&(t=t.toUpperCase()),this.search.focus(),this.search.val(t)}s(e)}})),e.delegate("abbr","mousedown",this.bind(function(e){this.enabled&&(this.clear(),s(e),this.close(),this.triggerChange(),this.selection.focus())})),this.setPlaceholder(),this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}))},clear:function(){this.opts.element.val(""),this.selection.find("span").empty(),this.selection.removeData("select2-data"),this.setPlaceholder()},initSelection:function(){if(""===this.opts.element.val())this.close(),this.setPlaceholder();else{var e=this;this.opts.initSelection.call(null,this.opts.element,function(n){n!==t&&null!==n&&(e.updateSelection(n),e.close(),e.setPlaceholder())})}},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return"select"===t.element.get(0).tagName.toLowerCase()&&(t.initSelection=function(t,n){var i=t.find(":selected");e.isFunction(n)&&n({id:i.attr("value"),text:i.text()})}),t},setPlaceholder:function(){var e=this.getPlaceholder();""===this.opts.element.val()&&e!==t&&!(this.select&&""!==this.select.find("option:first").text())&&(this.selection.find("span").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.selection.find("abbr").hide())},postprocessResults:function(t,n){var a=0,o=this,s=!0;this.results.find(".select2-result-selectable").each2(function(e,t){return i(o.id(t.data("select2-data")),o.opts.element.val())?(a=e,!1):void 0}),this.highlight(a),!0===n&&(s=this.showSearchInput=h(t.results)>=this.opts.minimumResultsForSearch,this.dropdown.find(".select2-search")[s?"removeClass":"addClass"]("select2-search-hidden"),e(this.dropdown,this.container)[s?"addClass":"removeClass"]("select2-with-searchbox"))},onSelect:function(e){var t=this.opts.element.val();this.opts.element.val(this.id(e)),this.updateSelection(e),this.close(),this.selection.focus(),i(t,this.id(e))||this.triggerChange()},updateSelection:function(e){var n=this.selection.find("span");this.selection.data("select2-data",e),n.empty(),e=this.opts.formatSelection(e,n),e!==t&&n.append(this.opts.escapeMarkup(e)),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.selection.find("abbr").show()},val:function(){var e,n=null,i=this;if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],this.select)this.select.val(e).find(":selected").each2(function(e,t){return n={id:t.attr("value"),text:t.text()},!1}),this.updateSelection(n),this.setPlaceholder();else{if(this.opts.initSelection===t)throw Error("cannot call val() if initSelection() is not defined");e?(this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){i.opts.element.val(e?i.id(e):""),i.updateSelection(e),i.setPlaceholder()})):this.clear()}},clearSearch:function(){this.search.val("")},data:function(e){var n;return 0===arguments.length?(n=this.selection.data("select2-data"),n==t&&(n=null),n):(e&&""!==e?(this.opts.element.val(e?this.id(e):""),this.updateSelection(e)):this.clear(),void 0)}}),y=g(m,{createContainer:function(){return e("<div></div>",{"class":"select2-container select2-container-multi"}).html("    <ul class='select2-choices'>  <li class='select2-search-field'>    <input type='text' autocomplete='off' class='select2-input'>  </li></ul><div class='select2-drop select2-drop-multi' style='display:none;'>   <ul class='select2-results'>   </ul></div>")},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return"select"===t.element.get(0).tagName.toLowerCase()&&(t.initSelection=function(t,n){var i=[];t.find(":selected").each2(function(e,t){i.push({id:t.attr("value"),text:t.text()})}),e.isFunction(n)&&n(i)}),t},initContainer:function(){var t;this.searchContainer=this.container.find(".select2-search-field"),this.selection=t=this.container.find(".select2-choices"),this.search.bind("keydown",this.bind(function(e){if(this.enabled){if(e.which===v.BACKSPACE&&""===this.search.val()){this.close();var n;if(n=t.find(".select2-search-choice-focus"),n.length>0)return this.unselect(n.first()),this.search.width(10),s(e),void 0;n=t.find(".select2-search-choice"),n.length>0&&n.last().addClass("select2-search-choice-focus")}else t.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(e.which){case v.UP:case v.DOWN:return this.moveHighlight(e.which===v.UP?-1:1),s(e),void 0;case v.ENTER:case v.TAB:return this.selectHighlighted(),s(e),void 0;case v.ESC:return this.cancel(e),s(e),void 0}e.which===v.TAB||v.isControl(e)||v.isFunctionKey(e)||e.which===v.BACKSPACE||e.which===v.ESC||!1===this.opts.openOnEnter&&e.which===v.ENTER||(this.open(),(e.which===v.PAGE_UP||e.which===v.PAGE_DOWN)&&s(e))}})),this.search.bind("keyup",this.bind(this.resizeSearch)),this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.clearSearch(),e.stopImmediatePropagation()})),this.container.delegate(".select2-choices","mousedown",this.bind(function(t){this.enabled&&!(e(t.target).closest(".select2-search-choice").length>0)&&(this.clearPlaceholder(),this.open(),this.focusSearch(),t.preventDefault())})),this.container.delegate(".select2-choices","focus",this.bind(function(){this.enabled&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.clearSearch()},enable:function(){this.enabled||(this.parent.enable.apply(this,arguments),this.search.removeAttr("disabled"))},disable:function(){this.enabled&&(this.parent.disable.apply(this,arguments),this.search.attr("disabled",!0))},initSelection:function(){if(""===this.opts.element.val()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var e=this;this.opts.initSelection.call(null,this.opts.element,function(n){n!==t&&null!==n&&(e.updateSelection(n),e.close(),e.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder();e!==t&&0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(e).addClass("select2-default"),this.resizeSearch()):this.search.val(" ").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")?this.search.val("").removeClass("select2-default"):" "===this.search.val()&&this.search.val("")},opening:function(){this.parent.opening.apply(this,arguments),this.clearPlaceholder(),this.resizeSearch(),this.focusSearch()},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var i=[],a=[],o=this;e(t).each(function(){0>n(o.id(this),i)&&(i.push(o.id(this)),a.push(this))}),t=a,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){o.addSelectedChoice(this)}),o.postprocessResults()},tokenize:function(){var e=this.search.val(),e=this.opts.tokenizer(e,this.data(),this.bind(this.onSelect),this.opts);null!=e&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e){this.addSelectedChoice(e),this.select&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.positionDropdown()):this.close(),this.triggerChange({added:e}),this.focusSearch()},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(t){var n,i=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),a=this.id(t),o=this.getVal();n=this.opts.formatSelection(t,i),i.find("div").replaceWith("<div>"+this.opts.escapeMarkup(n)+"</div>"),i.find(".select2-search-choice-close").bind("mousedown",s).bind("click dblclick",this.bind(function(t){this.enabled&&(e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),s(t))})).bind("focus",this.bind(function(){this.enabled&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),i.data("select2-data",t),i.insertBefore(this.searchContainer),o.push(a),this.setVal(o)},unselect:function(e){var t,i,a=this.getVal(),e=e.closest(".select2-search-choice");if(0===e.length)throw"Invalid argument: "+e+". Must be .select2-search-choice";t=e.data("select2-data"),i=n(this.id(t),a),i>=0&&(a.splice(i,1),this.setVal(a),this.select&&this.postprocessResults()),e.remove(),this.triggerChange({removed:t})},postprocessResults:function(){var e=this.getVal(),t=this.results.find(".select2-result-selectable"),i=this.results.find(".select2-result-with-children"),a=this;t.each2(function(t,i){var o=a.id(i.data("select2-data"));n(o,e)>=0?i.addClass("select2-disabled").removeClass("select2-result-selectable"):i.removeClass("select2-disabled").addClass("select2-result-selectable")}),i.each2(function(e,t){0==t.find(".select2-result-selectable").length?t.addClass("select2-disabled"):t.removeClass("select2-disabled")}),t.each2(function(e,t){return!t.hasClass("select2-disabled")&&t.hasClass("select2-result-selectable")?(a.highlight(0),!1):void 0})},resizeSearch:function(){var t,n,i,a,o=this.search.outerWidth()-this.search.width();t=this.search,x||(i=t[0].currentStyle||window.getComputedStyle(t[0],null),x=e("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:i.fontSize,fontFamily:i.fontFamily,fontStyle:i.fontStyle,fontWeight:i.fontWeight,letterSpacing:i.letterSpacing,textTransform:i.textTransform,whiteSpace:"nowrap"}),e("body").append(x)),x.text(t.val()),t=x.width()+10,n=this.search.offset().left,i=this.selection.width(),a=this.selection.offset().left,n=i-(n-a)-o,t>n&&(n=i-o),40>n&&(n=i-o),this.search.width(n)},getVal:function(){var e;return this.select?(e=this.select.val(),null===e?[]:e):(e=this.opts.element.val(),a(e,this.opts.separator))},setVal:function(t){var i;this.select?this.select.val(t):(i=[],e(t).each(function(){0>n(this,i)&&i.push(this)}),this.opts.element.val(0===i.length?"":i.join(this.opts.separator)))},val:function(){var n,i=[],a=this;if(0===arguments.length)return this.getVal();if(n=arguments[0])if(this.setVal(n),this.select)this.select.find(":selected").each(function(){i.push({id:e(this).attr("value"),text:e(this).text()})}),this.updateSelection(i);else{if(this.opts.initSelection===t)throw Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var n=e(t).map(a.id);a.setVal(n),a.updateSelection(t),a.clearSearch()})}else this.opts.element.val(""),this.updateSelection([]);this.clearSearch()},onSortStart:function(){if(this.select)throw Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t){var n,i=this;return 0===arguments.length?this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get():(t||(t=[]),n=e.map(t,function(e){return i.opts.id(e)}),this.setVal(n),this.updateSelection(t),this.clearSearch(),void 0)}}),e.fn.select2=function(){var i,a,o,s,r=Array.prototype.slice.call(arguments,0),l="val destroy opened open close focus isFocused container onSortStart onSortEnd enable disable positionDropdown data".split(" ");return this.each(function(){if(0===r.length||"object"==typeof r[0])i=0===r.length?{}:e.extend({},r[0]),i.element=e(this),"select"===i.element.get(0).tagName.toLowerCase()?s=i.element.attr("multiple"):(s=i.multiple||!1,"tags"in i&&(i.multiple=s=!0)),a=s?new y:new b,a.init(i);else{if("string"!=typeof r[0])throw"Invalid arguments to select2 plugin: "+r;if(0>n(r[0],l))throw"Unknown method: "+r[0];if(o=t,a=e(this).data("select2"),a!==t&&(o="container"===r[0]?a.container:a[r[0]].apply(a,r.slice(1)),o!==t))return!1}}),o===t?this:o},e.fn.select2.defaults={width:"copy",closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n){return t=[],r(e.text,n.term,t),t.join("")},formatSelection:function(e){return e?e.text:t},formatResultCssClass:function(){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){return"Please enter "+(t-e.length)+" more characters"},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return t.toUpperCase().indexOf(e.toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:f,escapeMarkup:function(e){return e&&"string"==typeof e?e.replace(/&/g,"&amp;"):e},blurOnChange:!1},window.Select2={query:{ajax:l,local:c,tags:u},util:{debounce:o,markMatch:r},"class":{"abstract":m,single:b,multi:y}}}}(jQuery),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,a,o,s,r=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?l+"":"null";case"boolean":case"null":return l+"";case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,n=0;o>n;n+=1)s[n]=str(n,l)||"null";return a=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+r+"]":"["+s.join(",")+"]",gap=r,a}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],a=str(i,l),a&&s.push(quote(i)+(gap?": ":":")+a));else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(a=str(i,l),a&&s.push(quote(i)+(gap?": ":":")+a));return a=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+r+"}":"{"+s.join(",")+"}",gap=r,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","    ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,a=e[t];if(a&&"object"==typeof a)for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(i=walk(a,n),void 0!==i?a[n]=i:delete a[n]);return reviver.call(e,t,a)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e){var t,n,i,a=e(window),o={jqueryui:{container:"ui-widget ui-widget-content ui-corner-all",notice:"ui-state-highlight",notice_icon:"ui-icon ui-icon-info",info:"",info_icon:"ui-icon ui-icon-info",success:"ui-state-default",success_icon:"ui-icon ui-icon-circle-check",error:"ui-state-error",error_icon:"ui-icon ui-icon-alert",closer:"ui-icon ui-icon-close",pin_up:"ui-icon ui-icon-pin-w",pin_down:"ui-icon ui-icon-pin-s",hi_menu:"ui-state-default ui-corner-bottom",hi_btn:"ui-state-default ui-corner-all",hi_btnhov:"ui-state-hover",hi_hnd:"ui-icon ui-icon-grip-dotted-horizontal"},bootstrap:{container:"alert",notice:"",notice_icon:"icon-exclamation-sign",info:"alert-info",info_icon:"icon-info-sign",success:"alert-success",success_icon:"icon-ok-sign",error:"alert-error",error_icon:"icon-warning-sign",closer:"icon-remove",pin_up:"icon-pause",pin_down:"icon-play",hi_menu:"well",hi_btn:"btn",hi_btnhov:"",hi_hnd:"icon-chevron-down"}},s=function(){i=e("body"),a=e(window),a.bind("resize",function(){n&&clearTimeout(n),n=setTimeout(e.pnotify_position_all,10)})};document.body?s():e(s),e.extend({pnotify_remove_all:function(){var t=a.data("pnotify");t&&t.length&&e.each(t,function(){this.pnotify_remove&&this.pnotify_remove()})},pnotify_position_all:function(){n&&clearTimeout(n),n=null;var t=a.data("pnotify");t&&t.length&&(e.each(t,function(){var e=this.opts.stack;e&&(e.nextpos1=e.firstpos1,e.nextpos2=e.firstpos2,e.addpos2=0,e.animation=!0)}),e.each(t,function(){this.pnotify_position()}))},pnotify:function(s){var r,l;"object"!=typeof s?(l=e.extend({},e.pnotify.defaults),l.text=s):l=e.extend({},e.pnotify.defaults,s);for(var c in l)"string"==typeof c&&c.match(/^pnotify_/)&&(l[c.replace(/^pnotify_/,"")]=l[c]);if(l.before_init&&l.before_init(l)===!1)return null;var u,p=function(t,n){f.css("display","none");var i=document.elementFromPoint(t.clientX,t.clientY);f.css("display","block");var a=e(i),o=a.css("cursor");f.css("cursor","auto"!=o?o:"default"),u&&u.get(0)==i||(u&&(d.call(u.get(0),"mouseleave",t.originalEvent),d.call(u.get(0),"mouseout",t.originalEvent)),d.call(i,"mouseenter",t.originalEvent),d.call(i,"mouseover",t.originalEvent)),d.call(i,n,t.originalEvent),u=a},h=o[l.styling],f=e("<div />",{"class":"ui-pnotify "+l.addclass,css:{display:"none"},mouseenter:function(e){l.nonblock&&e.stopPropagation(),l.mouse_reset&&"out"==r&&(f.stop(!0),r="in",f.css("height","auto").animate({width:l.width,opacity:l.nonblock?l.nonblock_opacity:l.opacity},"fast")),l.nonblock&&f.animate({opacity:l.nonblock_opacity},"fast"),l.hide&&l.mouse_reset&&f.pnotify_cancel_remove(),l.sticker&&!l.nonblock&&f.sticker.trigger("pnotify_icon").css("visibility","visible"),l.closer&&!l.nonblock&&f.closer.css("visibility","visible")},mouseleave:function(t){l.nonblock&&t.stopPropagation(),u=null,f.css("cursor","auto"),l.nonblock&&"out"!=r&&f.animate({opacity:l.opacity},"fast"),l.hide&&l.mouse_reset&&f.pnotify_queue_remove(),l.sticker_hover&&f.sticker.css("visibility","hidden"),l.closer_hover&&f.closer.css("visibility","hidden"),e.pnotify_position_all()},mouseover:function(e){l.nonblock&&e.stopPropagation()},mouseout:function(e){l.nonblock&&e.stopPropagation()},mousemove:function(e){l.nonblock&&(e.stopPropagation(),p(e,"onmousemove"))},mousedown:function(e){l.nonblock&&(e.stopPropagation(),e.preventDefault(),p(e,"onmousedown"))},mouseup:function(e){l.nonblock&&(e.stopPropagation(),e.preventDefault(),p(e,"onmouseup"))},click:function(e){l.nonblock&&(e.stopPropagation(),p(e,"onclick"))},dblclick:function(e){l.nonblock&&(e.stopPropagation(),p(e,"ondblclick"))}});f.opts=l,f.container=e("<div />",{"class":h.container+" ui-pnotify-container "+("error"==l.type?h.error:"info"==l.type?h.info:"success"==l.type?h.success:h.notice)}).appendTo(f),""!=l.cornerclass&&f.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow&&f.container.addClass("ui-pnotify-shadow"),f.pnotify_version="1.2.0",f.pnotify=function(t){var n=l;"string"==typeof t?l.text=t:l=e.extend({},l,t);for(var i in l)"string"==typeof i&&i.match(/^pnotify_/)&&(l[i.replace(/^pnotify_/,"")]=l[i]);return f.opts=l,l.cornerclass!=n.cornerclass&&f.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow!=n.shadow&&(l.shadow?f.container.addClass("ui-pnotify-shadow"):f.container.removeClass("ui-pnotify-shadow")),l.addclass===!1?f.removeClass(n.addclass):l.addclass!==n.addclass&&f.removeClass(n.addclass).addClass(l.addclass),l.title===!1?f.title_container.slideUp("fast"):l.title!==n.title&&(l.title_escape?f.title_container.text(l.title).slideDown(200):f.title_container.html(l.title).slideDown(200)),l.text===!1?f.text_container.slideUp("fast"):l.text!==n.text&&(l.text_escape?f.text_container.text(l.text).slideDown(200):f.text_container.html(l.insert_brs?(l.text+"").replace(/\n/g,"<br />"):l.text).slideDown(200)),f.pnotify_history=l.history,f.pnotify_hide=l.hide,l.type!=n.type&&f.container.removeClass(h.error+" "+h.notice+" "+h.success+" "+h.info).addClass("error"==l.type?h.error:"info"==l.type?h.info:"success"==l.type?h.success:h.notice),(l.icon!==n.icon||l.icon===!0&&l.type!=n.type)&&(f.container.find("div.ui-pnotify-icon").remove(),l.icon!==!1&&e("<div />",{"class":"ui-pnotify-icon"}).append(e("<span />",{"class":l.icon===!0?"error"==l.type?h.error_icon:"info"==l.type?h.info_icon:"success"==l.type?h.success_icon:h.notice_icon:l.icon})).prependTo(f.container)),l.width!==n.width&&f.animate({width:l.width}),l.min_height!==n.min_height&&f.container.animate({minHeight:l.min_height}),l.opacity!==n.opacity&&f.fadeTo(l.animate_speed,l.opacity),!l.closer||l.nonblock?f.closer.css("display","none"):f.closer.css("display","block"),!l.sticker||l.nonblock?f.sticker.css("display","none"):f.sticker.css("display","block"),f.sticker.trigger("pnotify_icon"),l.sticker_hover?f.sticker.css("visibility","hidden"):l.nonblock||f.sticker.css("visibility","visible"),l.closer_hover?f.closer.css("visibility","hidden"):l.nonblock||f.closer.css("visibility","visible"),l.hide?n.hide||f.pnotify_queue_remove():f.pnotify_cancel_remove(),f.pnotify_queue_position(),f},f.pnotify_position=function(e){var t=f.opts.stack;if(t){t.nextpos1||(t.nextpos1=t.firstpos1),t.nextpos2||(t.nextpos2=t.firstpos2),t.addpos2||(t.addpos2=0);var n="none"==f.css("display");if(!n||e){var i,o,s={};switch(t.dir1){case"down":o="top";break;case"up":o="bottom";break;case"left":o="right";break;case"right":o="left"}e=parseInt(f.css(o)),isNaN(e)&&(e=0),void 0!==t.firstpos1||n||(t.firstpos1=e,t.nextpos1=t.firstpos1);var r;switch(t.dir2){case"down":r="top";break;case"up":r="bottom";break;case"left":r="right";break;case"right":r="left"}if(i=parseInt(f.css(r)),isNaN(i)&&(i=0),void 0!==t.firstpos2||n||(t.firstpos2=i,t.nextpos2=t.firstpos2),("down"==t.dir1&&t.nextpos1+f.height()>a.height()||"up"==t.dir1&&t.nextpos1+f.height()>a.height()||"left"==t.dir1&&t.nextpos1+f.width()>a.width()||"right"==t.dir1&&t.nextpos1+f.width()>a.width())&&(t.nextpos1=t.firstpos1,t.nextpos2+=t.addpos2+(t.spacing2===void 0?25:t.spacing2),t.addpos2=0),t.animation&&i>t.nextpos2)switch(t.dir2){case"down":s.top=t.nextpos2+"px";break;case"up":s.bottom=t.nextpos2+"px";break;case"left":s.right=t.nextpos2+"px";break;case"right":s.left=t.nextpos2+"px"}else f.css(r,t.nextpos2+"px");switch(t.dir2){case"down":case"up":f.outerHeight(!0)>t.addpos2&&(t.addpos2=f.height());break;case"left":case"right":f.outerWidth(!0)>t.addpos2&&(t.addpos2=f.width())}if(t.nextpos1)if(t.animation&&(e>t.nextpos1||s.top||s.bottom||s.right||s.left))switch(t.dir1){case"down":s.top=t.nextpos1+"px";break;case"up":s.bottom=t.nextpos1+"px";break;case"left":s.right=t.nextpos1+"px";break;case"right":s.left=t.nextpos1+"px"}else f.css(o,t.nextpos1+"px");switch((s.top||s.bottom||s.right||s.left)&&f.animate(s,{duration:500,queue:!1}),t.dir1){case"down":case"up":t.nextpos1+=f.height()+(t.spacing1===void 0?25:t.spacing1);break;case"left":case"right":t.nextpos1+=f.width()+(t.spacing1===void 0?25:t.spacing1)}}}},f.pnotify_queue_position=function(t){n&&clearTimeout(n),t||(t=10),n=setTimeout(e.pnotify_position_all,t)},f.pnotify_display=function(){f.parent().length||f.appendTo(i),l.before_open&&l.before_open(f)===!1||("top"!=l.stack.push&&f.pnotify_position(!0),"fade"==l.animation||"fade"==l.animation.effect_in?f.show().fadeTo(0,0).hide():1!=l.opacity&&f.show().fadeTo(0,l.opacity).hide(),f.animate_in(function(){l.after_open&&l.after_open(f),f.pnotify_queue_position(),l.hide&&f.pnotify_queue_remove()}))},f.pnotify_remove=function(){f.timer&&(window.clearTimeout(f.timer),f.timer=null),l.before_close&&l.before_close(f)===!1||f.animate_out(function(){l.after_close&&l.after_close(f)===!1||(f.pnotify_queue_position(),l.remove&&f.detach())})},f.animate_in=function(e){r="in";var t;t=l.animation.effect_in!==void 0?l.animation.effect_in:l.animation,"none"==t?(f.show(),e()):"show"==t?f.show(l.animate_speed,e):"fade"==t?f.show().fadeTo(l.animate_speed,l.opacity,e):"slide"==t?f.slideDown(l.animate_speed,e):"function"==typeof t?t("in",e,f):f.show(t,"object"==typeof l.animation.options_in?l.animation.options_in:{},l.animate_speed,e)},f.animate_out=function(e){r="out";var t;t=l.animation.effect_out!==void 0?l.animation.effect_out:l.animation,"none"==t?(f.hide(),e()):"show"==t?f.hide(l.animate_speed,e):"fade"==t?f.fadeOut(l.animate_speed,e):"slide"==t?f.slideUp(l.animate_speed,e):"function"==typeof t?t("out",e,f):f.hide(t,"object"==typeof l.animation.options_out?l.animation.options_out:{},l.animate_speed,e)},f.pnotify_cancel_remove=function(){f.timer&&window.clearTimeout(f.timer)},f.pnotify_queue_remove=function(){f.pnotify_cancel_remove(),f.timer=window.setTimeout(function(){f.pnotify_remove()},isNaN(l.delay)?0:l.delay)},f.closer=e("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",visibility:l.closer_hover?"hidden":"visible"},click:function(){f.pnotify_remove(),f.sticker.css("visibility","hidden"),f.closer.css("visibility","hidden")
}}).append(e("<span />",{"class":h.closer})).appendTo(f.container),(!l.closer||l.nonblock)&&f.closer.css("display","none"),f.sticker=e("<div />",{"class":"ui-pnotify-sticker",css:{cursor:"pointer",visibility:l.sticker_hover?"hidden":"visible"},click:function(){l.hide=!l.hide,l.hide?f.pnotify_queue_remove():f.pnotify_cancel_remove(),e(this).trigger("pnotify_icon")}}).bind("pnotify_icon",function(){e(this).children().removeClass(h.pin_up+" "+h.pin_down).addClass(l.hide?h.pin_up:h.pin_down)}).append(e("<span />",{"class":h.pin_up})).appendTo(f.container),(!l.sticker||l.nonblock)&&f.sticker.css("display","none"),l.icon!==!1&&e("<div />",{"class":"ui-pnotify-icon"}).append(e("<span />",{"class":l.icon===!0?"error"==l.type?h.error_icon:"info"==l.type?h.info_icon:"success"==l.type?h.success_icon:h.notice_icon:l.icon})).prependTo(f.container),f.title_container=e("<h4 />",{"class":"ui-pnotify-title"}).appendTo(f.container),l.title===!1?f.title_container.hide():l.title_escape?f.title_container.text(l.title):f.title_container.html(l.title),f.text_container=e("<div />",{"class":"ui-pnotify-text"}).appendTo(f.container),l.text===!1?f.text_container.hide():l.text_escape?f.text_container.text(l.text):f.text_container.html(l.insert_brs?(l.text+"").replace(/\n/g,"<br />"):l.text),"string"==typeof l.width&&f.css("width",l.width),"string"==typeof l.min_height&&f.container.css("min-height",l.min_height),f.pnotify_history=l.history,f.pnotify_hide=l.hide;var g=a.data("pnotify");if((null==g||"object"!=typeof g)&&(g=[]),g="top"==l.stack.push?e.merge([f],g):e.merge(g,[f]),a.data("pnotify",g),"top"==l.stack.push&&f.pnotify_queue_position(1),l.after_init&&l.after_init(f),l.history){var v=a.data("pnotify_history");v===void 0&&(v=e("<div />",{"class":"ui-pnotify-history-container "+h.hi_menu,mouseleave:function(){v.animate({top:"-"+t+"px"},{duration:100,queue:!1})}}).append(e("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append(e("<button />",{"class":"ui-pnotify-history-all "+h.hi_btn,text:"All",mouseenter:function(){e(this).addClass(h.hi_btnhov)},mouseleave:function(){e(this).removeClass(h.hi_btnhov)},click:function(){return e.each(g,function(){this.pnotify_history&&(this.is(":visible")?this.pnotify_hide&&this.pnotify_queue_remove():this.pnotify_display&&this.pnotify_display())}),!1}})).append(e("<button />",{"class":"ui-pnotify-history-last "+h.hi_btn,text:"Last",mouseenter:function(){e(this).addClass(h.hi_btnhov)},mouseleave:function(){e(this).removeClass(h.hi_btnhov)},click:function(){var e,t=-1;do{if(e=-1==t?g.slice(t):g.slice(t,t+1),!e[0])break;t--}while(!e[0].pnotify_history||e[0].is(":visible"));return e[0]?(e[0].pnotify_display&&e[0].pnotify_display(),!1):!1}})).appendTo(i),t=e("<span />",{"class":"ui-pnotify-history-pulldown "+h.hi_hnd,mouseenter:function(){v.animate({top:"0"},{duration:100,queue:!1})}}).appendTo(v).offset().top+2,v.css({top:"-"+t+"px"}),a.data("pnotify_history",v))}return l.stack.animation=!1,f.pnotify_display(),f}});var r=/^on/,l=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,c=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,u=/^(scroll|resize|(un)?load|abort|error)$/,d=function(t,n){var i,t=t.toLowerCase();document.createEvent&&this.dispatchEvent?(t=t.replace(r,""),t.match(l)?(e(this).offset(),i=document.createEvent("MouseEvents"),i.initMouseEvent(t,n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget)):t.match(c)?(i=document.createEvent("UIEvents"),i.initUIEvent(t,n.bubbles,n.cancelable,n.view,n.detail)):t.match(u)&&(i=document.createEvent("HTMLEvents"),i.initEvent(t,n.bubbles,n.cancelable)),i&&this.dispatchEvent(i)):(t.match(r)||(t="on"+t),i=document.createEventObject(n),this.fireEvent(t,i))};e.pnotify.defaults={title:!1,title_escape:!1,text:!1,text_escape:!1,styling:"bootstrap",addclass:"",cornerclass:"",nonblock:!1,nonblock_opacity:.2,history:!0,width:"300px",min_height:"16px",type:"notice",icon:!0,animation:"fade",animate_speed:"slow",opacity:1,shadow:!0,closer:!0,closer_hover:!0,sticker:!0,sticker_hover:!0,hide:!0,delay:8e3,mouse_reset:!0,remove:!0,insert_brs:!0,stack:{dir1:"down",dir2:"left",push:"bottom",spacing1:25,spacing2:25}}}(jQuery),function(e,t,n,i){var a=n("html"),o=n(e),s=n(t),r=n.fancybox=function(){r.open.apply(this,arguments)},l=navigator.userAgent.match(/msie/i),c=null,u=t.createTouch!==i,d=function(e){return e&&e.hasOwnProperty&&e instanceof n},p=function(e){return e&&"string"===n.type(e)},h=function(e){return p(e)&&e.indexOf("%")>0},f=function(e,t){var n=parseInt(e,10)||0;return t&&h(e)&&(n*=r.getViewport()[t]/100),Math.ceil(n)},g=function(e,t){return f(e,t)+"px"};n.extend(r,{version:"2.1.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!u,fitToView:!0,aspectRatio:!1,topRatio:.5,leftRatio:.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(l?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:n.noop,beforeLoad:n.noop,afterLoad:n.noop,beforeShow:n.noop,afterShow:n.noop,beforeChange:n.noop,beforeClose:n.noop,afterClose:n.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){return e&&(n.isPlainObject(t)||(t={}),!1!==r.close(!0))?(n.isArray(e)||(e=d(e)?n(e).get():[e]),n.each(e,function(a,o){var s,l,c,u,h,f={};"object"===n.type(o)&&(o.nodeType&&(o=n(o)),d(o)?(f={href:o.data("fancybox-href")||o.attr("href"),title:o.data("fancybox-title")||o.attr("title"),isDom:!0,element:o},n.metadata&&n.extend(!0,f,o.metadata())):f=o),s=t.href||f.href||(p(o)?o:null),l=t.title!==i?t.title:f.title||"",u=(c=t.content||f.content)?"html":t.type||f.type,!u&&f.isDom&&(u=o.data("fancybox-type"),u||(u=(u=o.prop("class").match(/fancybox\.(\w+)/))?u[1]:null)),p(s)&&(u||(r.isImage(s)?u="image":r.isSWF(s)?u="swf":"#"===s.charAt(0)?u="inline":p(o)&&(u="html",c=o)),"ajax"===u&&(h=s.split(/\s+/,2),s=h.shift(),h=h.shift())),c||("inline"===u?s?c=n(p(s)?s.replace(/.*(?=#[^\s]+$)/,""):s):f.isDom&&(c=o):"html"===u?c=s:!u&&!s&&f.isDom&&(u="inline",c=o)),n.extend(f,{href:s,type:u,content:c,title:l,selector:h}),e[a]=f}),r.opts=n.extend(!0,{},r.defaults,t),t.keys!==i&&(r.opts.keys=t.keys?n.extend({},r.defaults.keys,t.keys):!1),r.group=e,r._start(r.opts.index)):void 0},cancel:function(){var e=r.coming;e&&!1!==r.trigger("onCancel")&&(r.hideLoading(),r.ajaxLoad&&r.ajaxLoad.abort(),r.ajaxLoad=null,r.imgPreload&&(r.imgPreload.onload=r.imgPreload.onerror=null),e.wrap&&e.wrap.stop(!0,!0).trigger("onReset").remove(),r.coming=null,r.current||r._afterZoomOut(e))},close:function(e){r.cancel(),!1!==r.trigger("beforeClose")&&(r.unbindEvents(),r.isActive&&(r.isOpen&&!0!==e?(r.isOpen=r.isOpened=!1,r.isClosing=!0,n(".fancybox-item, .fancybox-nav").remove(),r.wrap.stop(!0,!0).removeClass("fancybox-opened"),r.transitions[r.current.closeMethod]()):(n(".fancybox-wrap").stop(!0).trigger("onReset").remove(),r._afterZoomOut())))},play:function(e){var t=function(){clearTimeout(r.player.timer)},n=function(){t(),r.current&&r.player.isActive&&(r.player.timer=setTimeout(r.next,r.current.playSpeed))},i=function(){t(),s.unbind(".player"),r.player.isActive=!1,r.trigger("onPlayEnd")};!0===e||!r.player.isActive&&!1!==e?r.current&&(r.current.loop||r.current.index<r.group.length-1)&&(r.player.isActive=!0,s.bind({"onCancel.player beforeClose.player":i,"onUpdate.player":n,"beforeLoad.player":t}),n(),r.trigger("onPlayStart")):i()},next:function(e){var t=r.current;t&&(p(e)||(e=t.direction.next),r.jumpto(t.index+1,e,"next"))},prev:function(e){var t=r.current;t&&(p(e)||(e=t.direction.prev),r.jumpto(t.index-1,e,"prev"))},jumpto:function(e,t,n){var a=r.current;a&&(e=f(e),r.direction=t||a.direction[e>=a.index?"next":"prev"],r.router=n||"jumpto",a.loop&&(0>e&&(e=a.group.length+e%a.group.length),e%=a.group.length),a.group[e]!==i&&(r.cancel(),r._start(e)))},reposition:function(e,t){var i,a=r.current,o=a?a.wrap:null;o&&(i=r._getPosition(t),e&&"scroll"===e.type?(delete i.position,o.stop(!0,!0).animate(i,200)):(o.css(i),a.pos=n.extend({},a.dim,i)))},update:function(e){var t=e&&e.type,n=!t||"orientationchange"===t;n&&(clearTimeout(c),c=null),r.isOpen&&!c&&(c=setTimeout(function(){var i=r.current;i&&!r.isClosing&&(r.wrap.removeClass("fancybox-tmp"),(n||"load"===t||"resize"===t&&i.autoResize)&&r._setDimension(),"scroll"===t&&i.canShrink||r.reposition(e),r.trigger("onUpdate"),c=null)},n&&!u?0:300))},toggle:function(e){r.isOpen&&(r.current.fitToView="boolean"===n.type(e)?e:!r.current.fitToView,u&&(r.wrap.removeAttr("style").addClass("fancybox-tmp"),r.trigger("onUpdate")),r.update())},hideLoading:function(){s.unbind(".loading"),n("#fancybox-loading").remove()},showLoading:function(){var e,t;r.hideLoading(),e=n('<div id="fancybox-loading"><div></div></div>').click(r.cancel).appendTo("body"),s.bind("keydown.loading",function(e){27===(e.which||e.keyCode)&&(e.preventDefault(),r.cancel())}),r.defaults.fixed||(t=r.getViewport(),e.css({position:"absolute",top:.5*t.h+t.y,left:.5*t.w+t.x}))},getViewport:function(){var t=r.current&&r.current.locked||!1,n={x:o.scrollLeft(),y:o.scrollTop()};return t?(n.w=t[0].clientWidth,n.h=t[0].clientHeight):(n.w=u&&e.innerWidth?e.innerWidth:o.width(),n.h=u&&e.innerHeight?e.innerHeight:o.height()),n},unbindEvents:function(){r.wrap&&d(r.wrap)&&r.wrap.unbind(".fb"),s.unbind(".fb"),o.unbind(".fb")},bindEvents:function(){var e,t=r.current;t&&(o.bind("orientationchange.fb"+(u?"":" resize.fb")+(t.autoCenter&&!t.locked?" scroll.fb":""),r.update),(e=t.keys)&&s.bind("keydown.fb",function(a){var o=a.which||a.keyCode,s=a.target||a.srcElement;return 27===o&&r.coming?!1:(!(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey||s&&(s.type||n(s).is("[contenteditable]"))||!n.each(e,function(e,s){return t.group.length>1&&s[o]!==i?(r[e](s[o]),a.preventDefault(),!1):n.inArray(o,s)>-1?(r[e](),a.preventDefault(),!1):void 0})),void 0)}),n.fn.mousewheel&&t.mouseWheel&&r.wrap.bind("mousewheel.fb",function(e,i,a,o){for(var s=n(e.target||null),l=!1;s.length&&!l&&!s.is(".fancybox-skin")&&!s.is(".fancybox-wrap");)l=s[0]&&!(s[0].style.overflow&&"hidden"===s[0].style.overflow)&&(s[0].clientWidth&&s[0].scrollWidth>s[0].clientWidth||s[0].clientHeight&&s[0].scrollHeight>s[0].clientHeight),s=n(s).parent();0!==i&&!l&&r.group.length>1&&!t.canShrink&&(o>0||a>0?r.prev(o>0?"down":"left"):(0>o||0>a)&&r.next(0>o?"up":"right"),e.preventDefault())}))},trigger:function(e,t){var i,a=t||r.coming||r.current;if(a){if(n.isFunction(a[e])&&(i=a[e].apply(a,Array.prototype.slice.call(arguments,1))),!1===i)return!1;a.helpers&&n.each(a.helpers,function(t,i){i&&r.helpers[t]&&n.isFunction(r.helpers[t][e])&&r.helpers[t][e](n.extend(!0,{},r.helpers[t].defaults,i),a)}),s.trigger(e)}},isImage:function(e){return p(e)&&e.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(e){return p(e)&&e.match(/\.(swf)((\?|#).*)?$/i)},_start:function(e){var t,i,a={};if(e=f(e),t=r.group[e]||null,!t)return!1;if(a=n.extend(!0,{},r.opts,t),t=a.margin,i=a.padding,"number"===n.type(t)&&(a.margin=[t,t,t,t]),"number"===n.type(i)&&(a.padding=[i,i,i,i]),a.modal&&n.extend(!0,a,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}}),a.autoSize&&(a.autoWidth=a.autoHeight=!0),"auto"===a.width&&(a.autoWidth=!0),"auto"===a.height&&(a.autoHeight=!0),a.group=r.group,a.index=e,r.coming=a,!1===r.trigger("beforeLoad"))r.coming=null;else{if(i=a.type,t=a.href,!i)return r.coming=null,r.current&&r.router&&"jumpto"!==r.router?(r.current.index=e,r[r.router](r.direction)):!1;if(r.isActive=!0,("image"===i||"swf"===i)&&(a.autoHeight=a.autoWidth=!1,a.scrolling="visible"),"image"===i&&(a.aspectRatio=!0),"iframe"===i&&u&&(a.scrolling="scroll"),a.wrap=n(a.tpl.wrap).addClass("fancybox-"+(u?"mobile":"desktop")+" fancybox-type-"+i+" fancybox-tmp "+a.wrapCSS).appendTo(a.parent||"body"),n.extend(a,{skin:n(".fancybox-skin",a.wrap),outer:n(".fancybox-outer",a.wrap),inner:n(".fancybox-inner",a.wrap)}),n.each(["Top","Right","Bottom","Left"],function(e,t){a.skin.css("padding"+t,g(a.padding[e]))}),r.trigger("onReady"),"inline"===i||"html"===i){if(!a.content||!a.content.length)return r._error("content")}else if(!t)return r._error("href");"image"===i?r._loadImage():"ajax"===i?r._loadAjax():"iframe"===i?r._loadIframe():r._afterLoad()}},_error:function(e){n.extend(r.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:e,content:r.coming.tpl.error}),r._afterLoad()},_loadImage:function(){var e=r.imgPreload=new Image;e.onload=function(){this.onload=this.onerror=null,r.coming.width=this.width/r.opts.pixelRatio,r.coming.height=this.height/r.opts.pixelRatio,r._afterLoad()},e.onerror=function(){this.onload=this.onerror=null,r._error("image")},e.src=r.coming.href,!0!==e.complete&&r.showLoading()},_loadAjax:function(){var e=r.coming;r.showLoading(),r.ajaxLoad=n.ajax(n.extend({},e.ajax,{url:e.href,error:function(e,t){r.coming&&"abort"!==t?r._error("ajax",e):r.hideLoading()},success:function(t,n){"success"===n&&(e.content=t,r._afterLoad())}}))},_loadIframe:function(){var e=r.coming,t=n(e.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",u?"auto":e.iframe.scrolling).attr("src",e.href);n(e.wrap).bind("onReset",function(){try{n(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(e){}}),e.iframe.preload&&(r.showLoading(),t.one("load",function(){n(this).data("ready",1),u||n(this).bind("load.fb",r.update),n(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(),r._afterLoad()})),e.content=t.appendTo(e.inner),e.iframe.preload||r._afterLoad()},_preloadImages:function(){var e,t,n=r.group,i=r.current,a=n.length,o=i.preload?Math.min(i.preload,a-1):0;for(t=1;o>=t;t+=1)e=n[(i.index+t)%a],"image"===e.type&&e.href&&((new Image).src=e.href)},_afterLoad:function(){var e,t,i,a,o,s=r.coming,l=r.current;if(r.hideLoading(),s&&!1!==r.isActive)if(!1===r.trigger("afterLoad",s,l))s.wrap.stop(!0).trigger("onReset").remove(),r.coming=null;else{switch(l&&(r.trigger("beforeChange",l),l.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()),r.unbindEvents(),e=s.content,t=s.type,i=s.scrolling,n.extend(r,{wrap:s.wrap,skin:s.skin,outer:s.outer,inner:s.inner,current:s,previous:l}),a=s.href,t){case"inline":case"ajax":case"html":s.selector?e=n("<div>").html(e).find(s.selector):d(e)&&(e.data("fancybox-placeholder")||e.data("fancybox-placeholder",n('<div class="fancybox-placeholder"></div>').insertAfter(e).hide()),e=e.show().detach(),s.wrap.bind("onReset",function(){n(this).find(e).length&&e.hide().replaceAll(e.data("fancybox-placeholder")).data("fancybox-placeholder",!1)}));break;case"image":e=s.tpl.image.replace("{href}",a);break;case"swf":e='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+a+'"></param>',o="",n.each(s.swf,function(t,n){e+='<param name="'+t+'" value="'+n+'"></param>',o+=" "+t+'="'+n+'"'}),e+='<embed src="'+a+'" type="application/x-shockwave-flash" width="100%" height="100%"'+o+"></embed></object>"}(!d(e)||!e.parent().is(s.inner))&&s.inner.append(e),r.trigger("beforeShow"),s.inner.css("overflow","yes"===i?"scroll":"no"===i?"hidden":i),r._setDimension(),r.reposition(),r.isOpen=!1,r.coming=null,r.bindEvents(),r.isOpened?l.prevMethod&&r.transitions[l.prevMethod]():n(".fancybox-wrap").not(s.wrap).stop(!0).trigger("onReset").remove(),r.transitions[r.isOpened?s.nextMethod:s.openMethod](),r._preloadImages()}},_setDimension:function(){var e,t,i,a,o,s,l,c,u,d=r.getViewport(),p=0,v=!1,m=!1,v=r.wrap,b=r.skin,y=r.inner,w=r.current,m=w.width,x=w.height,_=w.minWidth,C=w.minHeight,k=w.maxWidth,S=w.maxHeight,T=w.scrolling,j=w.scrollOutside?w.scrollbarWidth:0,E=w.margin,$=f(E[1]+E[3]),L=f(E[0]+E[2]);if(v.add(b).add(y).width("auto").height("auto").removeClass("fancybox-tmp"),E=f(b.outerWidth(!0)-b.width()),e=f(b.outerHeight(!0)-b.height()),t=$+E,i=L+e,a=h(m)?(d.w-t)*f(m)/100:m,o=h(x)?(d.h-i)*f(x)/100:x,"iframe"===w.type){if(u=w.content,w.autoHeight&&1===u.data("ready"))try{u[0].contentWindow.document.location&&(y.width(a).height(9999),s=u.contents().find("body"),j&&s.css("overflow-x","hidden"),o=s.outerHeight(!0))}catch(P){}}else(w.autoWidth||w.autoHeight)&&(y.addClass("fancybox-tmp"),w.autoWidth||y.width(a),w.autoHeight||y.height(o),w.autoWidth&&(a=y.width()),w.autoHeight&&(o=y.height()),y.removeClass("fancybox-tmp"));if(m=f(a),x=f(o),c=a/o,_=f(h(_)?f(_,"w")-t:_),k=f(h(k)?f(k,"w")-t:k),C=f(h(C)?f(C,"h")-i:C),S=f(h(S)?f(S,"h")-i:S),s=k,l=S,w.fitToView&&(k=Math.min(d.w-t,k),S=Math.min(d.h-i,S)),t=d.w-$,L=d.h-L,w.aspectRatio?(m>k&&(m=k,x=f(m/c)),x>S&&(x=S,m=f(x*c)),_>m&&(m=_,x=f(m/c)),C>x&&(x=C,m=f(x*c))):(m=Math.max(_,Math.min(m,k)),w.autoHeight&&"iframe"!==w.type&&(y.width(m),x=y.height()),x=Math.max(C,Math.min(x,S))),w.fitToView)if(y.width(m).height(x),v.width(m+E),d=v.width(),$=v.height(),w.aspectRatio)for(;(d>t||$>L)&&m>_&&x>C&&!(p++>19);)x=Math.max(C,Math.min(S,x-10)),m=f(x*c),_>m&&(m=_,x=f(m/c)),m>k&&(m=k,x=f(m/c)),y.width(m).height(x),v.width(m+E),d=v.width(),$=v.height();else m=Math.max(_,Math.min(m,m-(d-t))),x=Math.max(C,Math.min(x,x-($-L)));j&&"auto"===T&&o>x&&t>m+E+j&&(m+=j),y.width(m).height(x),v.width(m+E),d=v.width(),$=v.height(),v=(d>t||$>L)&&m>_&&x>C,m=w.aspectRatio?s>m&&l>x&&a>m&&o>x:(s>m||l>x)&&(a>m||o>x),n.extend(w,{dim:{width:g(d),height:g($)},origWidth:a,origHeight:o,canShrink:v,canExpand:m,wPadding:E,hPadding:e,wrapSpace:$-b.outerHeight(!0),skinSpace:b.height()-x}),!u&&w.autoHeight&&x>C&&S>x&&!m&&y.height("auto")},_getPosition:function(e){var t=r.current,n=r.getViewport(),i=t.margin,a=r.wrap.width()+i[1]+i[3],o=r.wrap.height()+i[0]+i[2],i={position:"absolute",top:i[0],left:i[3]};return t.autoCenter&&t.fixed&&!e&&n.h>=o&&n.w>=a?i.position="fixed":t.locked||(i.top+=n.y,i.left+=n.x),i.top=g(Math.max(i.top,i.top+(n.h-o)*t.topRatio)),i.left=g(Math.max(i.left,i.left+(n.w-a)*t.leftRatio)),i},_afterZoomIn:function(){var e=r.current;e&&(r.isOpen=r.isOpened=!0,r.wrap.css("overflow","visible").addClass("fancybox-opened"),r.update(),(e.closeClick||e.nextClick&&r.group.length>1)&&r.inner.css("cursor","pointer").bind("click.fb",function(t){!n(t.target).is("a")&&!n(t.target).parent().is("a")&&(t.preventDefault(),r[e.closeClick?"close":"next"]())}),e.closeBtn&&n(e.tpl.closeBtn).appendTo(r.skin).bind("click.fb",function(e){e.preventDefault(),r.close()}),e.arrows&&r.group.length>1&&((e.loop||e.index>0)&&n(e.tpl.prev).appendTo(r.outer).bind("click.fb",r.prev),(e.loop||e.index<r.group.length-1)&&n(e.tpl.next).appendTo(r.outer).bind("click.fb",r.next)),r.trigger("afterShow"),e.loop||e.index!==e.group.length-1?r.opts.autoPlay&&!r.player.isActive&&(r.opts.autoPlay=!1,r.play()):r.play(!1))},_afterZoomOut:function(e){e=e||r.current,n(".fancybox-wrap").trigger("onReset").remove(),n.extend(r,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null}),r.trigger("afterClose",e)}}),r.transitions={getOrigPosition:function(){var e=r.current,t=e.element,n=e.orig,i={},a=50,o=50,s=e.hPadding,l=e.wPadding,c=r.getViewport();return!n&&e.isDom&&t.is(":visible")&&(n=t.find("img:first"),n.length||(n=t)),d(n)?(i=n.offset(),n.is("img")&&(a=n.outerWidth(),o=n.outerHeight())):(i.top=c.y+(c.h-o)*e.topRatio,i.left=c.x+(c.w-a)*e.leftRatio),("fixed"===r.wrap.css("position")||e.locked)&&(i.top-=c.y,i.left-=c.x),i={top:g(i.top-s*e.topRatio),left:g(i.left-l*e.leftRatio),width:g(a+l),height:g(o+s)}},step:function(e,t){var n,i,a=t.prop;i=r.current;var o=i.wrapSpace,s=i.skinSpace;("width"===a||"height"===a)&&(n=t.end===t.start?1:(e-t.start)/(t.end-t.start),r.isClosing&&(n=1-n),i="width"===a?i.wPadding:i.hPadding,i=e-i,r.skin[a](f("width"===a?i:i-o*n)),r.inner[a](f("width"===a?i:i-o*n-s*n)))},zoomIn:function(){var e=r.current,t=e.pos,i=e.openEffect,a="elastic"===i,o=n.extend({opacity:1},t);delete o.position,a?(t=this.getOrigPosition(),e.openOpacity&&(t.opacity=.1)):"fade"===i&&(t.opacity=.1),r.wrap.css(t).animate(o,{duration:"none"===i?0:e.openSpeed,easing:e.openEasing,step:a?this.step:null,complete:r._afterZoomIn})},zoomOut:function(){var e=r.current,t=e.closeEffect,n="elastic"===t,i={opacity:.1};n&&(i=this.getOrigPosition(),e.closeOpacity&&(i.opacity=.1)),r.wrap.animate(i,{duration:"none"===t?0:e.closeSpeed,easing:e.closeEasing,step:n?this.step:null,complete:r._afterZoomOut})},changeIn:function(){var e,t=r.current,n=t.nextEffect,i=t.pos,a={opacity:1},o=r.direction;i.opacity=.1,"elastic"===n&&(e="down"===o||"up"===o?"top":"left","down"===o||"right"===o?(i[e]=g(f(i[e])-200),a[e]="+=200px"):(i[e]=g(f(i[e])+200),a[e]="-=200px")),"none"===n?r._afterZoomIn():r.wrap.css(i).animate(a,{duration:t.nextSpeed,easing:t.nextEasing,complete:r._afterZoomIn})},changeOut:function(){var e=r.previous,t=e.prevEffect,i={opacity:.1},a=r.direction;"elastic"===t&&(i["down"===a||"up"===a?"top":"left"]=("up"===a||"left"===a?"-":"+")+"=200px"),e.wrap.animate(i,{duration:"none"===t?0:e.prevSpeed,easing:e.prevEasing,complete:function(){n(this).trigger("onReset").remove()}})}},r.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!u,fixed:!0},overlay:null,fixed:!1,el:n("html"),create:function(e){e=n.extend({},this.defaults,e),this.overlay&&this.close(),this.overlay=n('<div class="fancybox-overlay"></div>').appendTo(r.coming?r.coming.parent:e.parent),this.fixed=!1,e.fixed&&r.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(e){var t=this;e=n.extend({},this.defaults,e),this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(e),this.fixed||(o.bind("resize.overlay",n.proxy(this.update,this)),this.update()),e.closeClick&&this.overlay.bind("click.overlay",function(e){return n(e.target).hasClass("fancybox-overlay")?(r.isActive?r.close():t.close(),!1):void 0}),this.overlay.css(e.css).show()},close:function(){var e,t;o.unbind("resize.overlay"),this.el.hasClass("fancybox-lock")&&(n(".fancybox-margin").removeClass("fancybox-margin"),e=o.scrollTop(),t=o.scrollLeft(),this.el.removeClass("fancybox-lock"),o.scrollTop(e).scrollLeft(t)),n(".fancybox-overlay").remove().hide(),n.extend(this,{overlay:null,fixed:!1})},update:function(){var e,n="100%";this.overlay.width(n).height("100%"),l?(e=Math.max(t.documentElement.offsetWidth,t.body.offsetWidth),s.width()>e&&(n=s.width())):s.width()>o.width()&&(n=s.width()),this.overlay.width(n).height(s.height())},onReady:function(e,t){var i=this.overlay;n(".fancybox-overlay").stop(!0,!0),i||this.create(e),e.locked&&this.fixed&&t.fixed&&(i||(this.margin=s.height()>o.height()?n("html").css("margin-right").replace("px",""):!1),t.locked=this.overlay.append(t.wrap),t.fixed=!1),!0===e.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(e,t){var i,a;t.locked&&(!1!==this.margin&&(n("*").filter(function(){return"fixed"===n(this).css("position")&&!n(this).hasClass("fancybox-overlay")&&!n(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),i=o.scrollTop(),a=o.scrollLeft(),this.el.addClass("fancybox-lock"),o.scrollTop(i).scrollLeft(a)),this.open(e)},onUpdate:function(){this.fixed||this.update()},afterClose:function(e){this.overlay&&!r.coming&&this.overlay.fadeOut(e.speedOut,n.proxy(this.close,this))}},r.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(e){var t=r.current,i=t.title,a=e.type;if(n.isFunction(i)&&(i=i.call(t.element,t)),p(i)&&""!==n.trim(i)){switch(t=n('<div class="fancybox-title fancybox-title-'+a+'-wrap">'+i+"</div>"),a){case"inside":a=r.skin;break;case"outside":a=r.wrap;break;case"over":a=r.inner;break;default:a=r.skin,t.appendTo("body"),l&&t.width(t.width()),t.wrapInner('<span class="child"></span>'),r.current.margin[2]+=Math.abs(f(t.css("margin-bottom")))}t["top"===e.position?"prependTo":"appendTo"](a)}}},n.fn.fancybox=function(e){var t,i=n(this),a=this.selector||"",o=function(o){var s,l,c=n(this).blur(),u=t;!(o.ctrlKey||o.altKey||o.shiftKey||o.metaKey||c.is(".fancybox-wrap")||(s=e.groupAttr||"data-fancybox-group",l=c.attr(s),l||(s="rel",l=c.get(0)[s]),l&&""!==l&&"nofollow"!==l&&(c=a.length?n(a):i,c=c.filter("["+s+'="'+l+'"]'),u=c.index(this)),e.index=u,!1===r.open(c,e)||!o.preventDefault()))};return e=e||{},t=e.index||0,a&&!1!==e.live?s.undelegate(a,"click.fb-start").delegate(a+":not('.fancybox-item, .fancybox-nav')","click.fb-start",o):i.unbind("click.fb-start").bind("click.fb-start",o),this.filter("[data-fancybox-start=1]").trigger("click"),this},s.ready(function(){var t,o;if(n.scrollbarWidth===i&&(n.scrollbarWidth=function(){var e=n('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=e.children(),t=t.innerWidth()-t.height(99).innerWidth();return e.remove(),t}),n.support.fixedPosition===i){t=n.support,o=n('<div style="position:fixed;top:20px;"></div>').appendTo("body");var s=20===o[0].offsetTop||15===o[0].offsetTop;o.remove(),t.fixedPosition=s}n.extend(r.defaults,{scrollbarWidth:n.scrollbarWidth(),fixed:n.support.fixedPosition,parent:n("body")}),t=n(e).width(),a.addClass("fancybox-lock-test"),o=n(e).width(),a.removeClass("fancybox-lock-test"),n("<style type='text/css'>.fancybox-margin{margin-right:"+(o-t)+"px;}</style>").appendTo("head")})}(window,document,jQuery),define("toolbar",["underscore","text!page-templates/layout-manager.html","text!page-templates/popover.html","text!page-templates/sections.html","multiselect","tagsinput","select2","json2","pnotify","fancybox"],function(_,layoutTemp,popTemp,sectionTemp){function _getRowInfo(){var e=$("body").data("rowInfo");return e}var pageBuilder={canvasClass:".template-canvas",actionToolbar:".template-actions",removeIconClass:"icon-remove",defaultRowClass:"row-fluid",compiledTemplate:_.template(popTemp),attributeKey:"tagAttributes",pageDetails:{},init:function(){$(".grid-script").each(function(){var gridScript=$(this).text();eval(gridScript)})},poison:function(){var e=new Date;return e.getTime()},objToHtmlList:function(e,t){if(e instanceof Object&&!(e instanceof String)){var n=$("<ul>");for(var i in e){if(_.has(e[i],"title")){var a=$('<li class="asset layout-widget"/>'),o=[];if(!_.isEmpty(e[i].options)){o=e[i].options;var s=JSON.stringify(o);a.attr("data-options",s)}a.attr("id",t+"-"+e[i].id);var r=$('<a rel="tooltip"/>');r.text(e[i].title),r.attr("title",e[i].description),a.append(r),n.addClass("asset-list")}else{var a=$('<li class="jstree-open"/>'),r=$('<a href="#"/>');r.text(i),a.append(r),a.append(pageBuilder.objToHtmlList(e[i],t))}n.append(a)}return n}return document.createTextNode(e)},outerHtml:function(e){var t=$(e);return t.length>1?$.map(t,function(e){return $(e).outerHTML()}).join(""):t.clone().wrap("<div/>").parent().html()},addRowItem:function(e,t,n,i){var a=_getRowInfo();n=n||[];var o=_.has(n,"class")?n["class"]:pageBuilder.defaultRowClass;o.replace(","," ");var s=$('<div class="template-row"></div>').addClass(pageBuilder.defaultRowClass).data("type",e),r="",l=pageBuilder.poison();s.attr("id","row_"+l);var c=$(a);switch(e){case"single":r=$("<div></div>").addClass("span12");break;case"2-cols-eq":r=$("<div></div><div></div>").addClass("span6");break;case"2-cols-ll":r=$('<div class="span8"></div><div class="span4"></div>');break;case"2-cols-rl":r=$('<div class="span4"></div><div class="span8"></div>');break;case"3-cols":r=$("<div></div><div></div><div></div>").addClass("span4");break;case"4-cols":r=$("<div></div><div></div><div></div><div></div>").addClass("span3");break;default:!i&&e&&(i=e.split("-"));for(var u in i)if(i.hasOwnProperty(u)){var d="span"+i[u];r+='<div class="'+d+'"></div>'}var p=i.join("-");s.data("type",p)}r=$(r),$(r).each(function(){var e=$(this);e.data("class",e.attr("class"))});var h=$('<li class="asset ui-state-disabled">Empty</li>').data("id",0),f=$('<ul class="page-assets"/>').append(h);r.addClass("template-item").append(f),s.append(r),$(".template-row",t).show(),t.append(s),s.find(".page-assets").sortable({items:"li:not(.ui-state-disabled)",connectWith:".page-assets",tolerance:"pointer",receive:function(e,t){t.sender.hasClass("asset-list")?$("body").data("sort-ok",!0):pageBuilder.processAssets($(this))},update:function(){pageBuilder.processAssets($(this))}}),s.append(c);var g=$(".edit-row",s),v=n||{"class":o};return s.data(pageBuilder.attributeKey,v),pageBuilder.initPopover(s,g,"Row Attributes"),s},initPopover:function(e,t,n){n=n||"Asset Tag Attributes",t=$(t),t.popover({placement:"left",title:n,html:!0,content:function(){var t=e.attr("id"),n=t.split("-"),i=pageBuilder.pageDetails.widgets.items,a={};_.has(i,n[1])&&_.has(i[n[1]],"options")&&(a=i[n[1]].options);var o=e.data(pageBuilder.attributeKey),s={};_.has(o,"options")&&(s=o.options);for(var r in a)_.has(s,r)||(s[r]=a[r]);var l={tagList:pageBuilder.pageDetails.tags,elemTag:"div",options:s,id:e.attr("id")};return pageBuilder.compiledTemplate(l)},trigger:"click"}),t.on("click",function(){var t=$(this),n=t.siblings(".popover");n.find(".tags").each(function(){var e=$(this);e.tagsInput({width:"165px",height:"auto",removeWithBackspace:!0,defaultText:e.attr("placeholder")})}),$("#pop-cancel",n).on("click",function(e){e.preventDefault(),t.popover("hide")}),$("#pop-ok",n).on("click",function(n){n.preventDefault();for(var i=$(this).closest("form.attr-container"),a=i.serializeArray(),o={},s=0;a.length>s;s++){var r=a[s].name.split("_");1==r.length?o[a[s].name]=a[s].value:_.has(o,r[0])?o[r[0]][r[1]]=a[s].value:(o[r[0]]={},o[r[0]][r[1]]=a[s].value)}e.data(pageBuilder.attributeKey,o),pageBuilder.notify("Tag attribute","Item attribute updated","success"),t.popover("hide")});var i=e.data(pageBuilder.attributeKey);pageBuilder.populatePopover(i,n),n.find("select").select2()})},processAssets:function(e){var t=$("#item-buttons-template",$(layoutTemp)).html(),n=e.children("li");n.length>1?n.each(function(){var e=$(this);if(0==e.data("id"))e.hide();else if(0==e.find(".attr-trigger").length){e.prepend(t);var n=$(".attr-trigger",e);pageBuilder.initPopover(e,n)}}):n.show(),pageBuilder.updateSectionCount(),$.fancybox.update()},populatePopover:function(e,t){if(_.isObject(e))for(var n in e)if(e.hasOwnProperty(n))if(_.isObject(e[n]))for(var i in e[n]){var a=$('[name="'+n+"_"+i+'"]',t);
a.importTags(e[n][i])}else{var a=$('[name="'+n+'"]',t);a.hasClass("tags")?a.importTags(e[n]):a.val(e[n])}},getLayout:function(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var i=$("#"+n+"-section"),a=i.data(pageBuilder.attributeKey);t[n]={items:pageBuilder.processSection(i)},t[n][pageBuilder.attributeKey]=a||{}}return t},processSection:function(e){var t={},n="."+pageBuilder.defaultRowClass,i=$(n,e);return i.each(function(e,n){var i=$(n),a=i.find('[class^="span"]'),o=[];a.each(function(e,t){o[e]=pageBuilder.processColumn(t)});var s={rowItems:o,rowType:i.data("type")};s[pageBuilder.attributeKey]=i.data(pageBuilder.attributeKey)||{},t[e]=s}),t},processColumn:function(e){for(var t=$(e),n=t.data("class"),i=[],a=t.find("ul").sortable("toArray"),o=0;a.length>o;o++){var s=$("#"+a[o],t),r=s.data(pageBuilder.attributeKey);i[o]={name:a[o]},i[o][pageBuilder.attributeKey]=r||{}}return{"class":n,item:i}},rowSelected:function(e){e=$(e);var t=e.data("grid-id"),n=synergyDataGrid[t],i=n.getGridParam("selrow");return i?n.getRowData(i):(pageBuilder.notify("Row Selection","No row was selected. Please select a row from the grid to before performing the task","error"),!1)},checkSum:function(){for(var e=$("input","#custom-selector"),t=e.length,n=0,i=12,a=[],o=0;t>o;o++){var s=$(e[o]),r=s.val();n+=parseInt(r),a[o]=r}return 0==n-i?a:!1},manageSections:function(e){e=$(e);var t=pageBuilder.rowSelected(e);if(t){var n=e.data("href").replace(":id",t.id);e.data("entity");var i=_.template(sectionTemp);$.get(n,{},function(e){$(".temp").remove(),e.updateUrl=n;var t=i(e);t=$(t),$("body").append(t),$(".multiselect",t).multiselect({dividerLocation:.5,sortable:!0,searchable:!0,animated:"fast",show:"slideDown",hide:"slideUp",nodeComparator:function(e,t){var n=e.text(),i=t.text();return n==i?0:i>n?-1:1}}),t.dialog({width:473,height:400,position:"center",buttons:{Update:function(){var e=$('select[name="sectionId"]').val(),t={sections:e};$.ajax(n,{type:"PUT",data:t,success:function(e){e.error?pageBuilder.notify("Template Sections",e.message,"error"):pageBuilder.notify("Template Sections",e.message,"success")}})},Close:function(){$(this).dialog("close")}}})})}},manageLayout:function(e){var t=$(e),n=pageBuilder.rowSelected(e);if(n){window.synergyEnableWait=!1;var i=t.data("endpoint"),a=$("<div id='layout-manger-popup' title='Layout Manager'></div>"),o=_.template(layoutTemp),s=$(layoutTemp).find("#row-data-template").html();$("body").data("rowInfo",s),a.fancybox({type:"ajax",href:i+"/"+n.id,padding:10,maxHeight:"90%",openEffect:"elastic",modal:!0,ajax:{type:"GET",dataType:"json",data:{entity:t.data("entity"),id:n.id,menuId:_.has(n,"menuId")?n.menuId:!1}},afterLoad:function(){pageBuilder.pageDetails=this.content,1==this.content.error?(this.title="An Error Occurred",this.content=this.content.message):(this.title=this.content.title,this.content.pageBuilder=pageBuilder,this.content=o(this.content))},beforeShow:function(){var e=pageBuilder.pageDetails,t=$(".section",pageBuilder.canvasClass);pageBuilder.initPageLayout(e.page.layout,e.assets,e.widgets),$(".accordion").accordion({heightStyle:"content",collapsible:!0,active:1}),$(".action-btn",pageBuilder.actionToolbar).on("click",function(){var e=$(this),t=e.data("type");e.data("color");var n=$(".ui-selected");if(n.length>0)if(e.hasClass("custom-btn")){var i={min:1,max:11},a=$("#span-template").html();$(".custom-btn").popover({placement:"top",title:"Custom Rows",content:a,html:!0,trigger:"manual"}).popover("show"),$("input","#custom-selector").spinner(i),$("#add","#custom-selector").on("click",function(){var e=$('<label><input type="text" name="span[]" value="1"/>'),t=$(".popover.in");$(".btn-group","#custom-selector").before(e),$("input",e).spinner(i);var n=t.css("top").replace("px","")-30;return t.css("top",n+"px"),!1}),$("#cancel","#custom-selector").on("click",function(){return $(".custom-btn").popover("hide"),!1}),$("#ok","#custom-selector").on("click",function(){var e=pageBuilder.checkSum();return e===!1?(o="Row columns must add up to 12",pageBuilder.notify("Layout Manager",o,"error",!0)):(pageBuilder.addRowItem(t,n,null,e),$(".custom-btn").popover("hide"),$.fancybox.update()),!1})}else pageBuilder.addRowItem(t,n),$.fancybox.update();else{var o="No section was selected. Please select a section e.g. Header by clicking the section to add a row";pageBuilder.notify("Layout Manager",o,"error")}}),$(pageBuilder.canvasClass).selectable({filter:".section",cancel:".handle,btn,li,.badge-edit,.template-item"}),t.sortable({containment:pageBuilder.canvasClass,connectWith:".section",handle:".move-row",update:function(){$.fancybox.update()}}),t.each(function(){var e=$(this),t=$(".badge-edit",e),n=$(".attr-trigger",t),i=$(".status",e).text()+" Attributes";pageBuilder.initPopover(e,n,i)}),$(pageBuilder.canvasClass).on("load click",".row , .remove-row, .move-row, .item-delete",function(e){if(!confirm("You about about to delete this item. Click OK to continue"))return!1;var t=$(e.target);if("click"==e.type)if(e.preventDefault(),t.hasClass("item-delete")){var n=t.closest("li"),i=n.parent();n.remove(),pageBuilder.processAssets(i)}else t.hasClass("remove-row")&&(e.stopPropagation(),t.closest("."+pageBuilder.defaultRowClass).remove(),pageBuilder.updateSectionCount());else"load"==e.type&&t.hasClass(pageBuilder.defaultRowClass)&&t.sortable()}),$(".popup .label",".page-details").on("click",function(e){e.preventDefault();var t=$(this).parent(".popup");return t.hasClass("active")?t.removeClass("active"):(t.siblings().removeClass("active"),t.addClass("active")),!1});var n=$(".asset-list").not("#templates");n.sortable({connectWith:".page-assets",helper:"clone",revert:!0,items:"li.asset",tolerance:"pointer",stop:function(){var e=$("body"),t=e.data("temp-sort"),i=e.data("sort-ok");t&&i===!0&&(t.prev===!1?$(t.parent).prepend(t.clone):$(t.prev).after(t.clone),t.clone.show()),e.data("temp-sort",!1),n.sortable("refresh")},start:function(e,t){var n=$("body"),i=t.item.prev();i.length||(i=!1);var a={prev:i,clone:t.item.clone(),parent:t.item.parent()};n.data("temp-sort",a),n.data("sort-ok",!1)}}),$("#save",pageBuilder.actionToolbar).on("click",function(e){e.preventDefault(),window.synergyEnableWait=!1;var t=$(this),n=t.data("url"),i=pageBuilder.pageDetails,a={id:t.data("page-id"),themeId:$("#themeId",".page-details").val(),pageTheme:t.data("page-theme-id"),layout:pageBuilder.getLayout(i.sections)};return $.ajax(n,{type:"PUT",data:a,success:function(e){e.error?pageBuilder.notify("Page Layout",e.message,"error"):pageBuilder.notify("Page Layout",e.message)}}),!1}),$(".template-clone, #reset-layout").on("click",function(e){e.preventDefault();var t=$(this),n=t.data("layout-id"),i=pageBuilder.pageDetails;if(0==n){if(!confirm("You about about to reset this template. Click OK to continue"))return!1;var a=$("#save",pageBuilder.actionToolbar);pageBuilder.resetPageLayout();var o=a.data("url"),s={id:a.data("page-id"),themeId:a.data("page-theme-id"),layout:{}};$.ajax(o,{type:"PUT",data:s,success:function(e){e.error?pageBuilder.notify("Page Layout",e.error,"error"):pageBuilder.notify("Page Layout","Layout reset successfully")}})}else{if(!confirm("You about about to clone this template. This will overwrite the current layout. Click OK to continue"))return!1;pageBuilder.initPageLayout(i.templates.items[n].layout,i.assets,i.widgets),pageBuilder.notify("Page layout","template cloned successfully")}pageBuilder.updateSectionCount(),$.fancybox.update()}),$("#close",pageBuilder.actionToolbar).on("click",function(){$.fancybox.close()}),$.fancybox.update()},afterShow:function(){$(".tree",".page-details").each(function(){});var e=$(".att-trigger");e.popover({placement:"left",title:"Tag Attributes",content:function(){return $("#attribute-template").html()},html:!0,trigger:"click"});var t=$(".tags","#attribute-template");t.length&&t.tagsInput();var n=$(".close-attr","#attribute-template");n.on("click",function(e){return $(this).closest(".att-trigger").popover("hide"),e.preventDefault(),!1}),$("label.status").on("click",function(){$(this).siblings(".template-row").slideToggle(),$.fancybox.update()})},autoCenter:!0,autoResize:!0,autoSize:!0,autoScale:!0}).trigger("click")}},resetPageLayout:function(){var e=$('[id$="-section"]',".template-canvas");e.each(function(){$(this).children("."+pageBuilder.defaultRowClass).remove()})},updateSectionCount:function(){for(var e=$(".section",".template-canvas"),t=0,n=0;e.length>n;n++){var i=$(e[n]),a=$(".badge",i);t=$("li.asset",i).not(".ui-state-disabled").length,a.text(t),1>t?a.attr("class","badge badge-important"):a.attr("class","badge badge-info")}},notify:function notify(e,t,n,i){n=n||"info",i=i||"error"==n?!1:!0,$.pnotify({title:e,text:t,styling:"bootstrap",hide:i,opacity:.9,type:n,nonblock_opacity:.9})},initPageLayout:function(e,t,n){pageBuilder.resetPageLayout();var i;for(var a in e)if(e.hasOwnProperty(a)){var o=$("#"+a+"-section");if(o){i=0;var s=e[a].items||[],r=s.length;_.has(e[a],pageBuilder.attributeKey)&&o.data(pageBuilder.attributeKey,e[a][pageBuilder.attributeKey]);for(var l=0;r>l;l++){var c=_.has(s[l],pageBuilder.attributeKey)?s[l][pageBuilder.attributeKey]:{},u=pageBuilder.addRowItem(s[l].rowType,o,c);if(s[l].rowItems)for(var d=u.find('[class^="span"]'),p=0;d.length>p;p++)if(s[l].rowItems[p]){var h=$(d[p]).find("ul");if(s[l].rowItems[p].item)for(var f=0;s[l].rowItems[p].item.length>f;f++){var g=$("<li></li>"),v=s[l].rowItems[p].item[f],m=[],b="",y="";_.has(v,"name")?(m=v.name.split("-"),y=v.name):_.isString(v)?m=v.split("-"):v.name="undefined",m[0]==n.id?_.isUndefined(n.items[m[1]])?y=m[1]:(y=n.items[m[1]].title,b=n.items[m[1]].description):_.isUndefined(t[m[0]])||_.isUndefined(t[m[0]].items[m[1]])?y=m[1]:(y=t[m[0]].items[m[1]].title,b=t[m[0]].items[m[1]].description);var w=_.has(v,pageBuilder.attributeKey)?v[pageBuilder.attributeKey]:{};g.text(y).addClass("asset").attr("id",v.name).attr("title",b).data(pageBuilder.attributeKey,w),h.append(g)}pageBuilder.processAssets(h)}}}}}};return pageBuilder}),require(["./../config"],function(){require(["domReady","toolbar"],function(e,t){e(function(){(function(e,n,i){n==i&&(n={}),n.pageBuilder=t})(window,synergyDataGrid)})})}),"undefined"==typeof synergyDataGrid&&(synergyDataGrid={}),function(e,t,n){t==n&&(t={}),t.pageBuilder=toolbar}(window,synergyDataGrid);